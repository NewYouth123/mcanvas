!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MCanvas=e():t.MCanvas=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";r.d(e,"i",(function(){return n.a})),r.d(e,"c",(function(){return a})),r.d(e,"b",(function(){return c})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return u})),r.d(e,"a",(function(){return h})),r.d(e,"g",(function(){return f})),r.d(e,"h",(function(){return l})),r.d(e,"l",(function(){return d})),r.d(e,"f",(function(){return p})),r.d(e,"j",(function(){return g})),r.d(e,"k",(function(){return v}));var n=r(2),i=r(1);function o(t){var e={},r=e.toString,n=e.hasOwnProperty,i=n.toString,o=i.call(Object);if(!t||"[object Object]"!==r.call(t))return!1;var a=Object.getPrototypeOf(t);if(!a)return!0;var c=n.call(a,"constructor")&&a.constructor;return"function"==typeof c&&i.call(c)===o}function a(){for(var t,e,r,n,i,c,s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];var h=arguments[0]||{},f=1,l=arguments.length,d=!1;for("boolean"==typeof h&&(d=h,h=arguments[f]||{},f++),"object"!=typeof h&&"function"!=typeof h&&(h={}),f===l&&(h=this,f--);f<l;f++)if(null!==(t=arguments[f]))for(e in t)if(t.hasOwnProperty(e)){if(i=h[e],h===(n=t[e]))continue;d&&n&&(o(n)||(c=Array.isArray(n)))?(c?(c=!1,r=i&&Array.isArray(i)?i:[]):r=i&&o(i)?i:{},h[e]=a(d,r,n)):void 0!==n&&(h[e]=n)}return h}function c(t,e,r,n,i,o,a,c,s){void 0===o&&(o=0),void 0===a&&(a="#fff"),void 0===c&&(c=0),void 0===s&&(s="#000");var u=Math.min(n,i);2*o>u&&(o=u/2),t.save(),t.translate(e,r),function(t,e,r,n){t.beginPath(),t.arc(e-n,r-n,n,0,Math.PI/2),t.lineTo(n,r),t.arc(n,r-n,n,Math.PI/2,Math.PI),t.lineTo(0,n),t.arc(n,n,n,Math.PI,3*Math.PI/2),t.lineTo(e-n,0),t.arc(e-n,n,n,3*Math.PI/2,2*Math.PI),t.lineTo(e,r-n),t.closePath()}(t,n,i,o),t.fillStyle=a,t.fill(),t.lineWidth=c,t.strokeStyle=s,t.stroke(),t.restore()}function s(t,e,r){"string"==typeof t?i.a.loadImage(t,e,r):"object"==typeof t?e(t):v("getImage error, src="+t)}function u(t,e){for(var r in t)t.hasOwnProperty(r)&&e(r,t[r])}function h(){if("undefined"==typeof window)return!1;var t=window.navigator.userAgent.toLowerCase(),e=/(iPhone|iPad|iPod|iOS)/gi.test(t),r=/(iPad)/gi.test(t);if(e){var n=r?t.match(/cpu os (\d*)/):t.match(/iphone os (\d*)/);return!!(n&&+n[1]<9)}return!1}function f(t){var e,r;return"IMG"===t.tagName?(e=t.naturalWidth,r=t.naturalHeight):(!function(t){t.tagName}(t),e=t.width,r=t.height),{iw:e,ih:r}}function l(t,e){return t.indexOf&&-1!==t.indexOf(e)}function d(t,e,r,i){var o=r;if(n.a.str(r))if(l(r,":")&&"pos"===i){var a=r.split(":"),c=a[0],s=a[1];switch(c){case"left":case"top":o=+s.replace("px","");break;case"right":case"bottom":o=t-+s.replace("px","")-e}}else o=l(r,"px")?+r.replace("px",""):l(r,"%")?("crop"===i?e:t)*+r.replace("%","")/100:l(["top","left"],r)?0:l(["bottom","right"],r)?t-e:"center"===r?(t-e)/2:"origin"===r?e:+r;return Math.round(o)}function p(t,e){var r=e;return n.a.str(e)&&(r=l(e,"px")?+e.replace("px",""):l(e,"%")?t*+e.replace("%","")/100:"center"===e?t/2:+e),Math.round(r)}function g(t){throw new Error("[MCanvas ERROR]: "+t)}function v(t){throw new Error("[MCanvas WARN]: "+t)}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n=r(4)._Canvas},function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n={};function i(t){var e=n.toString.call(t);return null===t?t+"":Number.isNaN(t)?"NaN":"object"==typeof t||"function"==typeof t?n[e]||"object":typeof t}"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach((function(t){n["[object "+t+"]"]=t.toLowerCase()}));var o={primitive:function(t){return["string","number"].includes(i(t))},array:function(t){return"array"===i(t)},str:function(t){return"string"===i(t)},obj:function(t){return"object"===i(t)},arr:function(t){return"array"===i(t)},num:function(t){return"number"===i(t)},fn:function(t){return"function"===i(t)},undef:function(t){return"undefined"===i(t)},def:function(t){return!o.undef(t)},null:function(t){return"null"===i(t)},empty:function(t){switch(i(t)){case"object":return 0===Object.keys(t).length;case"array":return 0===t.length;case"string":return!t.trim();case"undefined":case"null":case"NaN":case"boolean":return!0;default:return!1}},Nil:function(t){return["null","undefined"].includes(i(t))},NaN:function(t){return"NaN"===i(t)},promise:function(t){return!!t&&(o.obj(t)||o.fn(t))&&o.fn(t.then)}}},function(t,e,r){t.exports=r(5)},function(t,e,r){"use strict";r.r(e),r.d(e,"_Canvas",(function(){return i}));var n=r(0),i={name:"WebCanvas",loadImage:function(t,e,r){var n=new Image;0===t.indexOf("http")&&(n.crossOrigin="*"),n.onload=function(){return e(n)},n.onerror=function(){return r("img load error.url: "+t)},n.src=t},create:function(t,e){var r=document.createElement("canvas"),i=r.getContext("2d");return n.i.num(t)&&(r.width=t),n.i.num(e)&&(r.height=e),[r,i]}}},function(t,e,r){"use strict";r.r(e),r.d(e,"MCompose",(function(){return a})),r.d(e,"MImage",(function(){return b}));var n=r(0),i=r(1);function o(t,e){var r=Object(n.g)(t),o=r.iw,a=r.ih,c=Object(n.c)(!0,{x:0,y:0,width:"100%",height:"100%",radius:0},e),s=c.width,u=c.height,h=c.x,f=c.y,l=c.radius;(s=Object(n.f)(o,s))>o&&(s=o),(u=Object(n.f)(a,u))>a&&(u=a),h=Object(n.l)(o,s,h,"pos"),f=Object(n.l)(a,u,f,"pos"),l=Object(n.f)(o,l);var d=i.a.create(s,u),p=d[0],g=d[1];return p.width=s,p.height=u,Object(n.b)(g,0,0,s,u,l),g.globalCompositeOperation="source-in",g.drawImage(t,-h,-f,o,a),{cvs:p,ctx:g}}var a=function(){function t(t){void 0===t&&(t={}),this.queue=[],this.fn={success:function(){},error:function(t){}},this.data={textId:0,text:{},bgConfig:null},this._defaultFontFamily="helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif",this.ops=Object(n.c)({width:500,height:500,backgroundColor:""},t),this._init()}return t.prototype._init=function(){var t,e=this.ops,r=e.width,n=e.height,o=e.backgroundColor;t=i.a.create(r,n),this.cvs=t[0],this.ctx=t[1],o&&this._setBgColor(o)},t.prototype.background=function(t,e){var r=this;return void 0===e&&(e={type:"origin"}),t||this.data.bgConfig?(t?(e.image=t,this.data.bgConfig=e):this.data.bgConfig&&(e=this.data.bgConfig),this.queue.push((function(){e.color&&r._setBgColor(e.color),Object(n.e)(e.image,(function(t){return r._background(t,e)}),r.fn.error)})),this):(Object(n.j)("the init background must has a image."),this)},t.prototype._setBgColor=function(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.cvs.width,this.cvs.height)},t.prototype._getBgAlign=function(t,e,r,i){var o;return n.i.str(t)?"50%"===t||"center"===t?o=Math.abs((e-r/i)/2):"100%"===t?o=Math.abs(e-r/i):"0%"===t&&(o=0):o=n.i.num(t)?t:0,o},t.prototype._background=function(t,e){var r,i,o,a,c,s,u,h,f,l=Object(n.g)(t),d=l.iw,p=l.ih,g=d/p,v=this.cvs.width/this.cvs.height;switch(e.type){case"crop":g>v?(o=p*v,a=p,f=this.cvs.height/p):(a=(o=d)/v,f=this.cvs.width/d),r=this._getBgAlign(e.left,d,this.cvs.width,f),i=this._getBgAlign(e.top,p,this.cvs.height,f),s=c=0,h=this.cvs.height,u=this.cvs.width;break;case"contain":i=r=0,o=d,a=p,g>v?(h=(u=this.cvs.width)/g,c=e.left||0,s=e.top||0===e.top?e.top:(this.cvs.height-h)/2):(u=(h=this.cvs.height)*g,s=e.top||0,c=e.left||0===e.left?e.left:(this.cvs.width-u)/2);break;case"origin":this.cvs.width=d,this.cvs.height=p,r=i=0,o=d,a=p,c=s=0,u=this.cvs.width,h=this.cvs.height;break;default:return void Object(n.j)("background type error!")}this.ctx.drawImage(t,r,i,o,a,c,s,u,h),this._next()},t.prototype.rect=function(t){var e=this;return this.queue.push((function(){var r=e.cvs,i=r.width,o=r.height,a=t.fillColor,c=void 0===a?"#fff":a,s=t.strokeColor,u=void 0===s?c:s,h=t.strokeWidth,f=void 0===h?0:h,l=t.radius,d=void 0===l?0:l,p=t.width,g=void 0===p?0:p,v=t.height,y=void 0===v?0:v,b=t.x,x=void 0===b?0:b,m=t.y,w=void 0===m?0:m;g=Object(n.l)(i,0,g,"pos")-2*f,y=Object(n.l)(o,0,y,"pos")-2*f,x=Object(n.l)(i,g,x,"pos")+(Object(n.h)(x,"right")?-f:f),w=Object(n.l)(o,y,w,"pos")+(Object(n.h)(w,"bottom")?-f:f),Object(n.b)(e.ctx,x,w,g,y,d,c,f,u),e._resetCtx()._next()})),this},t.prototype.circle=function(t){var e=this;return this.queue.push((function(){var r=t.fillColor,i=void 0===r?"#fff":r,o=t.strokeColor,a=void 0===o?i:o,c=t.strokeWidth,s=void 0===c?0:c,u=e.cvs,h=u.width,f=u.height,l=Object(n.l)(h,0,t.r||0,"pos")-2*s,d=t.x,p=void 0===d?0:d,g=t.y,v=void 0===g?0:g;p=Object(n.l)(h,2*l,p,"pos")+l+(Object(n.h)(p,"right")?-s:s),v=Object(n.l)(f,2*l,v,"pos")+l+(Object(n.h)(v,"bottom")?-s:s),e.ctx.beginPath(),e.ctx.arc(p,v,l,0,2*Math.PI,!1),e.ctx.fillStyle=i,e.ctx.fill(),e.ctx.strokeStyle=a,e.ctx.lineWidth=s,e.ctx.stroke(),e.ctx.closePath(),e._resetCtx()._next()})),this},t.prototype._resetCtx=function(){return this.ctx.setTransform(1,0,0,1,0,0),this},t.prototype.watermark=function(t,e){if(!t)return Object(n.j)("there is not image of watermark."),this;var r=e.width,i=void 0===r?"40%":r,o=e.pos,a=void 0===o?"rightbottom":o,c=e.margin,s=void 0===c?20:c,u={x:0,y:0,scale:1,rotate:0};switch(a){case"leftTop":u.x="left:"+s,u.y="top:"+s;break;case"leftBottom":u.x="left:"+s,u.y="bottom:"+s;break;case"rightTop":u.x="right:"+s,u.y="top:"+s;break;case"rightBottom":u.x="right:"+s,u.y="bottom:"+s}return this.add(t,{width:i,pos:u}),this},t.prototype.add=function(t,e){var r=this,i={width:"100%",crop:{x:0,y:0,width:"100%",height:"100%",radius:0},pos:{x:0,y:0,scale:1,rotate:0}};return(n.i.arr(t)?t:[{image:t,options:e}]).map((function(t){var e=t.image,o=t.options;r.queue.push((function(){Object(n.e)(e,(function(t){r._add(t,r._handleOps(t,Object(n.c)(!0,i,o)))}),r.fn.error)}))})),this},t.prototype._add=function(t,e){var r,a=e.crop,c=e.pos,s=e.width;0===s&&Object(n.k)("the width of mc-element is zero");var u,h,f,l,d=Object(n.g)(t),p=d.iw,g=d.ih,v=a.width,y=a.height,b=a.radius;(v!==p||y!==g||b>0)&&(t=o(t,a).cvs);var x,m,w,j,O,_,I=v/y,C=p>g?p/g:g/p,M=1.4*C>5?5:1.4*C,k=i.a.create(Math.round(v*M),Math.round(y*M)),S=k[0],P=k[1],T=Object(n.a)()&&(S.width>2096||S.height>2096)?2096:4096,q=I>1?T/S.width:T/S.height;x=-Math.round(v/2),m=-Math.round(y/2),w=v,j=Math.round(v/I),(S.width>T||S.height>T)&&q&&(r=[S.width,S.height,x,m,w,j].map((function(t){return Math.round(t*q)})),S.width=r[0],S.height=r[1],x=r[2],m=r[3],w=r[4],j=r[5]),P.translate(S.width/2,S.height/2),P.rotate(c.rotate),P.drawImage(t,x,m,w,j),f=Math.round(s*M),l=Math.round(f/I),_=(O=(M-1)*s/2)/I,u=Math.round(c.x+f*(1-c.scale)/2-O),h=Math.round(c.y+l*(1-c.scale)/2-_),f*=c.scale,l*=c.scale,this.ctx.drawImage(S,u,h,f,l),this._next()},t.prototype._getRotate=function(t){return n.i.str(t)?parseFloat(t)*Math.PI/180:n.i.num(t)?t*Math.PI/180:0},t.prototype._handleOps=function(t,e){var r,i,o=this.cvs,a=o.width,c=o.height,s=Object(n.g)(t),u=s.iw,h=s.ih,f=u/h,l=Object(n.l)(a,u,e.width,"pos"),d=Object(n.l)(a,u,e.crop.width,"crop"),p=Object(n.l)(c,h,e.crop.height,"crop"),g={width:d,height:p,x:Object(n.l)(u,d,e.crop.x,"crop"),y:Object(n.l)(h,p,e.crop.y,"crop"),radius:Object(n.f)(d,e.crop.radius)};g.x>u&&(g.x=u),g.y>h&&(g.y=h),r=u-g.x,i=h-g.y,g.width>r&&(g.width=r),g.height>i&&(g.height=i);var v=e.pos,y=v.x,b=v.y,x=v.rotate,m=v.scale,w=void 0===m?1:m;return{width:l,crop:g,pos:{x:Object(n.l)(a,l,y,"pos"),y:Object(n.l)(c,l/f,b,"pos"),scale:w,rotate:this._getRotate(x)}}},t.prototype._createStyle=function(t,e){return{font:t+"px "+this._defaultFontFamily,lineHeight:e,color:"#000",type:"fill",lineWidth:1,shadow:{color:null,blur:0,offsetX:0,offsetY:0}}},t.prototype.text=function(t,e){var r=this;void 0===t&&(t="");var i=this.cvs.width/20;return this.queue.push((function(){var o,a=Object(n.c)(!0,{width:300,align:"left",smallStyle:r._createStyle(.8*i,.9*i),normalStyle:r._createStyle(i,1.1*i),largeStyle:r._createStyle(1.3*i,1.4*i),pos:{x:0,y:0,rotate:0}},e),c=r._parse(t),s=0;c.map((function(t){t.size>s&&(s=t.size,o=t.type)}));var u=parseInt(a[o+"Style"].font);u&&a.width<u&&(a.width=u),r._text(c,a),r._resetCtx()._next()})),this},t.prototype._parse=function(t){for(var e=t.split(/<s>|<b>/),r=[],n=0;n<e.length;n++){var i=e[n];if(/<\/s>|<\/b>/.test(i)){var o=/<\/s>/.test(i)?"</s>":"</b>",a=/<\/s>/.test(i)?"small":"large",c=e[n].split(o);r.push({type:a,text:c[0],size:"small"===a?0:2}),c[1]&&r.push({type:"normal",text:c[1],size:1})}else e[n]&&r.push({text:e[n],type:"normal",size:1})}return r},t.prototype._text=function(t,e){var r=this;this.data.textId++,this.data.text[this.data.textId]={};var o,a=e.width=Object(n.l)(this.cvs.width,0,e.width,"pos"),c=1,s=0,u=this._getLineHeight(t,e),h=Object(n.l)(this.cvs.width,a,0,"pos"),f=Object(n.l)(this.cvs.height,0,0,"pos")+u;this.data.text[this.data.textId][c]={data:[],lineWidth:0},t.map((function(t){o=e[t.type+"Style"],r.ctx.font=o.font;var i=r.ctx.measureText(t.text).width,l=t.text.replace(/<br>/g,"|");if(s+i>a||Object(n.h)(l,"|"))for(var d=0,p=l.length;d<p;d++){var g,v=l[d];if(i=r.ctx.measureText(v).width,!(s+i>a||"|"===v)||(h=s=0,f+=u,c+=1,r.data.text[r.data.textId][c]={data:[],lineWidth:0},"|"!==v))(g=r.data.text[r.data.textId][c]).data.push({context:v,x:h,y:f,style:o,width:i}),h+=i,g.lineWidth=s+=i}else(g=r.data.text[r.data.textId][c]).data.push({context:l,x:h,y:f,style:o,width:i}),h+=i,g.lineWidth=s+=i}));var l=i.a.create(a,this._getTextRectHeight(c)),d=l[0],p=l[1],g=d.height,v=d.width,y=Object(n.l)(this.cvs.width,v,e.pos.x,"pos"),b=Object(n.l)(this.cvs.height,g,e.pos.y,"pos");Object(n.d)(this.data.text[this.data.textId],(function(t,n){var i=0;n.lineWidth<a&&("center"===e.align?i=(a-n.lineWidth)/2:"right"===e.align&&(i=a-n.lineWidth)),n.data.map((function(t){t.x+=i,r._fillText(p,t)}))})),this.ctx.translate(y+v/2,b+g/2),this.ctx.rotate(this._getRotate(e.pos.rotate)),this.ctx.drawImage(d,-v/2,-g/2,v,g)},t.prototype._getLineHeight=function(t,e){var r,n=0;return t.map((function(t){(r=e[t.type+"Style"].lineHeight)>n&&(n=r)})),n},t.prototype._fillText=function(t,e){var r=e.context,i=e.x,o=e.y,a=e.style,c=a.align,s=a.lineWidth,u=a.shadow,h=a.font,f=a.gradient,l=a.lineHeight,d=u.color,p=u.blur,g=u.offsetX,v=u.offsetY;if(t.font=h,t.textAlign=c,t.textBaseline="alphabetic",t.lineWidth=s,t.shadowColor=d,t.shadowBlur=p,t.shadowOffsetX=g,t.shadowOffsetY=v,f){var y=f.type,b=f.colorStop,x=void 0,m=void 0,w=void 0,j=void 0;1===y?(x=i,m=o,w=i+e.width,j=o):(x=i,m=o-l,w=i,j=o);var O=t.createLinearGradient(x,m,w,j),_=b.length||0;Object(n.d)(b,(function(t,e){O.addColorStop(1/_*(+t+1),e)})),t[a.type+"Style"]=O}else t[a.type+"Style"]=a.color;t[a.type+"Text"](r,i,o),this._resetCtx()},t.prototype._getTextRectHeight=function(t){var e=this.data.text[this.data.textId][t].data[0];return e.y+e.style.lineHeight},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(r,i){var o={type:"jpeg",quality:.9,exportType:"base64",success:function(t){},error:function(t){}};n.i.fn(t)?o.success=t:"jpg"===(o=Object(n.c)(!0,o,t)).type&&(o.type="jpeg"),e.fn.error=function(t){o.error(t),i(t)},e.fn.success=function(){"canvas"===o.exportType?(o.success(e.cvs),r(e.cvs)):setTimeout((function(){var t=e.cvs.toDataURL("image/"+o.type,o.quality);o.success(t),r(t)}),0)},e._next()}))},t.prototype._next=function(){if(this.queue.length>0){this.ctx.save();var t=this.queue.shift();t&&t(),this.ctx.restore()}else this.fn.success()},t.prototype.clear=function(){return this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function c(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function c(t){try{s(n.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,c)}s((n=n.apply(t,e||[])).next())}))}function s(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}Object.create;function u(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,c=o.length;a<c;a++,i++)n[i]=o[a];return n}Object.create;var h=r(2),f=function(){function t(t){var e=this;this.isFirst=!0,this.queue=[],this._next=function(t){if(e.isFirst||(t=e.after(t)),e.queue.length>0){var r=e.queue.shift();r&&(t=e.before(t),r(e._next,t),e.isFirst=!1)}else e.end(t),e.queue=[]};var r=t||{},n=r.before,i=void 0===n?function(t){return t}:n,o=r.after,a=void 0===o?function(t){return t}:o;this.before=i,this.after=a}return t.prototype.push=function(t){h.a.fn(t)&&this.queue.push(t)},t.prototype.perform=function(t,e){this.end=t,this._next(e)},t}();function l(t,e,r,n,i){var o,a,c,s,u,h,f,l,d,p,g,v,y,b,x=2*i+1,m=i+1,w=r-1,j=0,O=[];for(d=0,p=256*x;d<p;d+=1)O[d]=d/x|0;for(v=0;v<n;v+=1){for(o=a=c=s=0,u=v,o+=m*t[h=j<<2],a+=m*t[h+1],c+=m*t[h+2],s+=m*t[h+3],d=1;d<=i;d+=1)o+=t[h=j+(d<r?d:w)<<2],a+=t[h+1],c+=t[h+2],s+=t[h+3];for(g=0;g<r;g+=1)e[h=u<<2]=O[o],e[h+1]=O[a],e[h+2]=O[c],e[h+3]=O[s],(y=g+m)>w&&(y=w),(b=g-i)<0&&(b=0),l=j+b<<2,o+=t[f=j+y<<2]-t[l],a+=t[f+1]-t[l+1],c+=t[f+2]-t[l+2],s+=t[f+3]-t[l+3],u+=n;j+=r}}function d(t,e){void 0===e&&(e=6);for(var r=t.width,n=t.height,i=t.getContext("2d"),o=i.getImageData(0,0,r,n).data,a=i.createImageData(r,n),c=a.data,s=i.createImageData(r,n).data,u=0;u<e;u+=1)l(u?c:o,s,r,n,2),l(s,c,r,n,2);return i.putImageData(a,0,0),[t,i]}function p(t,e){void 0===e&&(e="hor");var r,n,i,o,a=t.width,c=t.height,s=t.getContext("2d"),u=s.getImageData(0,0,a,c).data,h=s.createImageData(a,c),f=h.data;for(r=0;r<c;r++)for(n=0;n<a;n++)i=4*(r*a+n),f[o="hor"===e?4*(r*a+(a-n-1)):4*((c-r-1)*a+n)]=u[i],f[o+1]=u[i+1],f[o+2]=u[i+2],f[o+3]=u[i+3];return s.putImageData(h,0,0),[t,s]}function g(t){var e,r,n=t.width,i=t.height,o=t.getContext("2d"),a=o.getImageData(0,0,n,i).data,c=o.createImageData(n,i),s=c.data;for(e=0;e<a.length;e+=4)r=.3*a[e]+.59*a[e+1]+.11*a[e+2],s[e]=s[e+1]=s[e+2]=r,s[e+3]=a[e+3];return o.putImageData(c,0,0),[t,o]}function v(t,e){void 0===e&&(e=10);var r,n,i,o,a,c,s,u,h,f,l,d,p,g,v,y=t.width,b=t.height,x=t.getContext("2d"),m=x.getImageData(0,0,y,b).data,w=x.createImageData(y,b),j=w.data,O=Math.ceil(y/e),_=Math.ceil(b/e);for(r=0;r<_;r++)for((c=(a=r*e)+e)>b&&(c=b),n=0;n<O;n++){for((o=(i=n*e)+e)>y&&(o=y),d=p=g=v=0,l=(o-i)*(c-a),u=a;u<c;u+=1)for(h=u*y,s=i;s<o;s+=1)d+=m[f=h+s<<2],p+=m[f+1],g+=m[f+2],v+=m[f+3];for(d=d/l+.5|0,p=p/l+.5|0,g=g/l+.5|0,v=v/l+.5|0,u=a;u<c;u++)for(h=u*y,s=i;s<o;s++)j[f=h+s<<2]=d,j[f+1]=p,j[f+2]=g,j[f+3]=v}return x.putImageData(w,0,0),[t,x]}function y(t,e,r){void 0===e&&(e=2),void 0===r&&(r=32);var n,i,o,a,c,s,u,h,f,l,d,p,g,v,y,b,x,m,w=t.width,j=t.height,O=t.getContext("2d"),_=O.getImageData(0,0,w,j).data,I=O.createImageData(w,j),C=I.data,M=[],k=[],S=[],P=[],T=[],q=[],D=0;for(s=0;s<j;s++)for(c=0;c<w;c++){for(u=0;u<r;u++)M[u]=k[u]=S[u]=P[u]=T[u]=q[u]=0;for(h=-e;h<=e;h++)if(!((n=s+h)<0||n>=j))for(o=n*w,f=-e;f<=e;f++)(i=c+f)<0||i>=w||(l=_[a=o+i<<2],v=(d=_[a+1])*r>>8,y=(p=_[a+2])*r>>8,P[g=l*r>>8]+=l,T[v]+=d,q[y]+=p,M[g]+=1,k[v]+=1,S[y]+=1);for(b=x=m=0,u=1;u<r;u++)M[u]>M[b]&&(b=u),k[u]>k[x]&&(x=u),S[u]>S[m]&&(m=u);C[D]=P[b]/M[b]|0,C[D+1]=T[x]/k[x]|0,C[D+2]=q[m]/S[m]|0,C[D+3]=_[D+3],D+=4}return O.putImageData(I,0,0),[t,O]}var b=function(){function t(t){this._image=t,this._queue=new f,this.clear()}return t.prototype.clear=function(){this._getImage()._drawCanvas()},t.prototype._drawCanvas=function(){return this._run((function(t){var e=Object(n.g)(t),r=e.iw,o=e.ih,a=i.a.create(r,o),c=a[0],s=a[1];return s.drawImage(t,0,0,r,o),{cvs:c,ctx:s}}))},t.prototype._getImage=function(){var t=this;return this._run((function(){return new Promise((function(e){n.i.str(t._image)?Object(n.e)(t._image,(function(r){e(t._image=r)}),t._error):e(t._image)}))}))},t.prototype._run=function(t){var e=this;return this._queue.push((function(r,i){setTimeout((function(){return c(e,void 0,void 0,(function(){var e;return s(this,(function(o){return e=t(i),n.i.promise(e)?e.then(r):r(e),[2]}))}))}),0)})),this},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(r,i){var o={type:"jpeg",quality:1,exportType:"base64",success:function(t){},error:function(t){}};n.i.fn(t)?o.success=t:"jpg"===(o=Object(n.c)(!0,o,t)).type&&(o.type="jpeg");var a=function(t){o.success(t),r(t)};e._error=function(t){o.error(t),i(t)},e._queue.perform((function(t){var e=t.cvs;"canvas"===o.exportType?a(e):setTimeout((function(){var t=e.toDataURL("image/"+o.type,o.quality);a(t)}),0)}))}))},t.prototype.crop=function(t){return this._run((function(e){return o(e.cvs,t)}))},t.prototype.compress=function(t){return void 0===t&&(t={}),this.draw(t)},t.prototype.filter=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this._run((function(r){var n,i,o,a,c,s=r.cvs,h=s,f=r.ctx;switch(t){case"blur":h=(n=d.apply(void 0,u([s],e)))[0],f=n[1];break;case"flip":h=(i=p.apply(void 0,u([s],e)))[0],f=i[1];break;case"gray":h=(o=g(s))[0],f=o[1];break;case"mosaic":h=(a=v.apply(void 0,u([s],e)))[0],f=a[1];break;case"oil":h=(c=y.apply(void 0,u([s],e)))[0],f=c[1]}return{cvs:h,ctx:f}}))},t}();e.default=a}])}));