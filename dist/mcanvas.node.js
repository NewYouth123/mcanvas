!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MCanvas=e():t.MCanvas=e()}(global,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e){t.exports=require("util")},function(t,e,n){"use strict";t.exports=n(13)},function(t,e){t.exports=require("stream")},function(t,e,n){"use strict";const r=n(0);function i(t,e,n,r){if(!(this instanceof i))throw new TypeError("Class constructors cannot be invoked without 'new'");"object"==typeof t&&(r=t.w,n=t.z,e=t.y,t=t.x),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.z="number"==typeof n?n:0,this.w="number"==typeof r?r:1}const o=180/Math.PI,s=Math.PI/180;function a(t){var e=t.split(/\(/,1)[0];switch(e){case"matrix":return function(t){var e=t.replace(/matrix\(/,"");if(6!==(e=e.split(/,/,7)).length)throw new Error("Failed to parse "+t);return[(e=e.map(parseFloat))[0],e[1],0,0,e[2],e[3],0,0,0,0,1,0,e[4],e[5],0,1]}(t);case"matrix3d":return function(t){var e=t.replace(/matrix3d\(/,"");if(16!==(e=e.split(/,/,17)).length)throw new Error("Failed to parse "+t);return e.map(parseFloat)}(t);default:throw new Error(e+" parsing not implemented")}}function u(t){if(!(this instanceof u))throw new TypeError("Class constructors cannot be invoked without 'new'");var e;if(this._is2D=!0,this._values=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),"string"==typeof t){if(""===t)return;var n=t.split(/\)\s+/,20).map(a);if(0===n.length)return;for(t=n[0],e=1;e<n.length;e++)t=p(n[e],t)}if(e=0,t&&6===t.length)c(this,0,t[e++]),c(this,1,t[e++]),c(this,4,t[e++]),c(this,5,t[e++]),c(this,12,t[e++]),c(this,13,t[e++]);else if(t&&16===t.length)c(this,0,t[e++]),c(this,1,t[e++]),h(this,2,t[e++]),h(this,3,t[e++]),c(this,4,t[e++]),c(this,5,t[e++]),h(this,6,t[e++]),h(this,7,t[e++]),h(this,8,t[e++]),h(this,9,t[e++]),h(this,10,t[e++]),h(this,11,t[e++]),c(this,12,t[e++]),c(this,13,t[e++]),h(this,14,t[e++]),h(this,15,t[e]);else if(void 0!==t)throw new TypeError("Expected string or array.")}function c(t,e,n){if("number"!=typeof n)throw new TypeError("Expected number");return t._values[e]=n}function h(t,e,n){if("number"!=typeof n)throw new TypeError("Expected number");return 10===e||15===e?1!==n&&(t._is2D=!1):0!==n&&(t._is2D=!1),t._values[e]=n}function f(t){var e=Object.create(u.prototype);return e.constructor=u,e._is2D=!0,e._values=t,e}function p(t,e){for(var n=new Float64Array(16),r=0;r<4;r++)for(var i=0;i<4;i++){for(var o=0,s=0;s<4;s++)o+=t[4*r+s]*e[4*s+i];n[4*r+i]=o}return n}u.fromMatrix=function(t){if(!(t instanceof u))throw new TypeError("Expected DOMMatrix");return new u(t._values)},u.fromFloat32Array=function(t){if(!(t instanceof Float32Array))throw new TypeError("Expected Float32Array");return new u(t)},u.fromFloat64Array=function(t){if(!(t instanceof Float64Array))throw new TypeError("Expected Float64Array");return new u(t)},u.prototype[r.inspect.custom||"inspect"]=function(t,e){return t<0?"[DOMMatrix]":`DOMMatrix [\n    a: ${this.a}\n    b: ${this.b}\n    c: ${this.c}\n    d: ${this.d}\n    e: ${this.e}\n    f: ${this.f}\n    m11: ${this.m11}\n    m12: ${this.m12}\n    m13: ${this.m13}\n    m14: ${this.m14}\n    m21: ${this.m21}\n    m22: ${this.m22}\n    m23: ${this.m23}\n    m23: ${this.m23}\n    m31: ${this.m31}\n    m32: ${this.m32}\n    m33: ${this.m33}\n    m34: ${this.m34}\n    m41: ${this.m41}\n    m42: ${this.m42}\n    m43: ${this.m43}\n    m44: ${this.m44}\n    is2D: ${this.is2D}\n    isIdentity: ${this.isIdentity} ]`},u.prototype.toString=function(){return this.is2D?`matrix(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f})`:`matrix3d(${this._values.join(", ")})`},Object.defineProperties(u.prototype,{m11:{get:function(){return this._values[0]},set:function(t){return c(this,0,t)}},m12:{get:function(){return this._values[1]},set:function(t){return c(this,1,t)}},m13:{get:function(){return this._values[2]},set:function(t){return h(this,2,t)}},m14:{get:function(){return this._values[3]},set:function(t){return h(this,3,t)}},m21:{get:function(){return this._values[4]},set:function(t){return c(this,4,t)}},m22:{get:function(){return this._values[5]},set:function(t){return c(this,5,t)}},m23:{get:function(){return this._values[6]},set:function(t){return h(this,6,t)}},m24:{get:function(){return this._values[7]},set:function(t){return h(this,7,t)}},m31:{get:function(){return this._values[8]},set:function(t){return h(this,8,t)}},m32:{get:function(){return this._values[9]},set:function(t){return h(this,9,t)}},m33:{get:function(){return this._values[10]},set:function(t){return h(this,10,t)}},m34:{get:function(){return this._values[11]},set:function(t){return h(this,11,t)}},m41:{get:function(){return this._values[12]},set:function(t){return c(this,12,t)}},m42:{get:function(){return this._values[13]},set:function(t){return c(this,13,t)}},m43:{get:function(){return this._values[14]},set:function(t){return h(this,14,t)}},m44:{get:function(){return this._values[15]},set:function(t){return h(this,15,t)}},a:{get:function(){return this.m11},set:function(t){return this.m11=t}},b:{get:function(){return this.m12},set:function(t){return this.m12=t}},c:{get:function(){return this.m21},set:function(t){return this.m21=t}},d:{get:function(){return this.m22},set:function(t){return this.m22=t}},e:{get:function(){return this.m41},set:function(t){return this.m41=t}},f:{get:function(){return this.m42},set:function(t){return this.m42=t}},is2D:{get:function(){return this._is2D}},isIdentity:{get:function(){var t=this._values;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}}}),u.prototype.multiply=function(t){return f(this._values).multiplySelf(t)},u.prototype.multiplySelf=function(t){return this._values=p(t._values,this._values),t.is2D||(this._is2D=!1),this},u.prototype.preMultiplySelf=function(t){return this._values=p(this._values,t._values),t.is2D||(this._is2D=!1),this},u.prototype.translate=function(t,e,n){return f(this._values).translateSelf(t,e,n)},u.prototype.translateSelf=function(t,e,n){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof n&&(n=0),this._values=p([1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1],this._values),0!==n&&(this._is2D=!1),this},u.prototype.scale=function(t,e,n,r,i,o){return f(this._values).scaleSelf(t,e,n,r,i,o)},u.prototype.scale3d=function(t,e,n,r){return f(this._values).scale3dSelf(t,e,n,r)},u.prototype.scale3dSelf=function(t,e,n,r){return this.scaleSelf(t,t,t,e,n,r)},u.prototype.scaleSelf=function(t,e,n,r,i,o){return"number"!=typeof r&&(r=0),"number"!=typeof i&&(i=0),"number"!=typeof o&&(o=0),this.translateSelf(r,i,o),"number"!=typeof t&&(t=1),"number"!=typeof e&&(e=t),"number"!=typeof n&&(n=1),this._values=p([t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1],this._values),this.translateSelf(-r,-i,-o),1===n&&0===o||(this._is2D=!1),this},u.prototype.rotateFromVector=function(t,e){return f(this._values).rotateFromVectorSelf(t,e)},u.prototype.rotateFromVectorSelf=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var n=0===t&&0===e?0:Math.atan2(e,t)*o;return this.rotateSelf(n)},u.prototype.rotate=function(t,e,n){return f(this._values).rotateSelf(t,e,n)},u.prototype.rotateSelf=function(t,e,n){var r,i;return void 0===e&&void 0===n&&(n=t,t=e=0),"number"!=typeof e&&(e=0),"number"!=typeof n&&(n=0),0===t&&0===e||(this._is2D=!1),t*=s,e*=s,n*=s,r=Math.cos(n),i=Math.sin(n),this._values=p([r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1],this._values),r=Math.cos(e),i=Math.sin(e),this._values=p([r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1],this._values),r=Math.cos(t),i=Math.sin(t),this._values=p([1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1],this._values),this},u.prototype.rotateAxisAngle=function(t,e,n,r){return f(this._values).rotateAxisAngleSelf(t,e,n,r)},u.prototype.rotateAxisAngleSelf=function(t,e,n,r){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof n&&(n=0);var i=Math.sqrt(t*t+e*e+n*n);if(0===i)return this;1!==i&&(t/=i,e/=i,n/=i),r*=s;var o=Math.cos(r),a=Math.sin(r),u=1-o,c=u*t,h=u*e;return this._values=p([c*t+o,c*e+a*n,c*n-a*e,0,c*e-a*n,h*e+o,h*n+a*t,0,c*n+a*e,h*n-a*t,u*n*n+o,0,0,0,0,1],this._values),0===t&&0===e||(this._is2D=!1),this},u.prototype.skewX=function(t){return f(this._values).skewXSelf(t)},u.prototype.skewXSelf=function(t){if("number"!=typeof t)return this;var e=Math.tan(t*s);return this._values=p([1,0,0,0,e,1,0,0,0,0,1,0,0,0,0,1],this._values),this},u.prototype.skewY=function(t){return f(this._values).skewYSelf(t)},u.prototype.skewYSelf=function(t){if("number"!=typeof t)return this;var e=Math.tan(t*s);return this._values=p([1,e,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._values),this},u.prototype.flipX=function(){return f(p([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._values))},u.prototype.flipY=function(){return f(p([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],this._values))},u.prototype.inverse=function(){return f(this._values).invertSelf()},u.prototype.invertSelf=function(){throw new Error("Not implemented")},u.prototype.setMatrixValue=function(t){var e=new u(t);return this._values=e._values,this._is2D=e._is2D,this},u.prototype.transformPoint=function(t){var e=(t=new i(t)).x,n=t.y,r=t.z,o=t.w,s=this._values;return new i(s[0]*e+s[4]*n+s[8]*r+s[12]*o,s[1]*e+s[5]*n+s[9]*r+s[13]*o,s[2]*e+s[6]*n+s[10]*r+s[14]*o,s[3]*e+s[7]*n+s[11]*r+s[15]*o)},u.prototype.toFloat32Array=function(){return Float32Array.from(this._values)},u.prototype.toFloat64Array=function(){return this._values.slice(0)},t.exports={DOMMatrix:u,DOMPoint:i}},function(t,e,n){"use strict";
/*!
 * Canvas - Context2d
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const r=n(1),i=n(5),{DOMMatrix:o}=n(3);r.CanvasRenderingContext2dInit(o,i),t.exports=r.CanvasRenderingContext2d},function(t,e,n){"use strict";const r="'([^']+)'|\"([^\"]+)\"|[\\w\\s-]+",i=new RegExp("(bold|bolder|lighter|[1-9]00) +","i"),o=new RegExp("(italic|oblique) +","i"),s=new RegExp("(small-caps) +","i"),a=new RegExp("(ultra-condensed|extra-condensed|condensed|semi-condensed|semi-expanded|expanded|extra-expanded|ultra-expanded) +","i"),u=new RegExp("([\\d\\.]+)(px|pt|pc|in|cm|mm|%|em|ex|ch|rem|q) *((?:"+r+")( *, *(?:"+r+"))*)"),c={};t.exports=function(t){if(c[t])return c[t];const e=u.exec(t);if(!e)return;const n={weight:"normal",style:"normal",stretch:"normal",variant:"normal",size:parseFloat(e[1]),unit:e[2],family:e[3].replace(/["']/g,"").replace(/ *, */g,",")};let r,h,f,p,l=t.substring(0,e.index);switch((r=i.exec(l))&&(n.weight=r[1]),(h=o.exec(l))&&(n.style=h[1]),(f=s.exec(l))&&(n.variant=f[1]),(p=a.exec(l))&&(n.stretch=p[1]),n.unit){case"pt":n.size/=.75;break;case"pc":n.size*=16;break;case"in":n.size*=96;break;case"cm":n.size*=96/2.54;break;case"mm":n.size*=96/25.4;break;case"%":break;case"em":case"rem":n.size*=16/.75;break;case"q":n.size*=96/25.4/4}return c[t]=n}},function(t,e,n){"use strict";
/*!
 * Canvas - PNGStream
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */var r=n(2).Readable,i=n(0),o=t.exports=function t(e,n){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");if(r.call(this),n&&n.palette instanceof Uint8ClampedArray&&n.palette.length%4!=0)throw new Error("Palette length must be a multiple of 4.");this.canvas=e,this.options=n||{}};function s(){}i.inherits(o,r),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamPNGSync((function(e,n,r){e?t.emit("error",e):r?t.push(n):t.push(null)}),t.options)}},function(t,e,n){"use strict";
/*!
 * Canvas - PDFStream
 */var r=n(2).Readable,i=n(0),o=t.exports=function t(e,n){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");r.call(this),this.canvas=e,this.options=n};function s(){}i.inherits(o,r),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamPDFSync((function(e,n,r){e?t.emit("error",e):r?t.push(n):t.push(null)}),this.options)}},function(t,e,n){"use strict";
/*!
 * Canvas - JPEGStream
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */var r=n(2).Readable,i=n(0),o=t.exports=function t(e,n){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");if(void 0===e.streamJPEGSync)throw new Error("node-canvas was built without JPEG support.");r.call(this),this.options=n,this.canvas=e};function s(){}i.inherits(o,r),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamJPEGSync(this.options,(function(e,n){e?t.emit("error",e):n?t.push(n):t.push(null)}))}},function(t,e,n){t.exports=n(29)},function(t,e,n){"use strict";n.r(e),n.d(e,"_Canvas",(function(){return s}));var r=n(11),i=r.createCanvas,o=r.loadImage,s={name:"NodeCanvas",create:function(t,e){void 0===t&&(t=500),void 0===e&&(e=500);var n=i(t,e),r=n.getContext("2d");return[n,r]},loadImage:function(t,e,n){o(t).then(e).catch(n)}}},function(t,e,n){const r=n(12),i=n(15),o=n(4),s=n(5),a=n(27),u=n(1),c=n(28),h=n(6),f=n(7),p=n(8),l=n(3).DOMMatrix,d=n(3).DOMPoint;t.exports={Canvas:r,Context2d:o,CanvasRenderingContext2D:o,CanvasGradient:u.CanvasGradient,CanvasPattern:u.CanvasPattern,Image:i,ImageData:u.ImageData,PNGStream:h,PDFStream:f,JPEGStream:p,DOMMatrix:l,DOMPoint:d,registerFont:function(t,e){return r._registerFont(c.realpathSync(t),e)},parseFont:s,createCanvas:function(t,e,n){return new r(t,e,n)},createImageData:function(t,e,n){return new u.ImageData(t,e,n)},loadImage:function(t){return new Promise((e,n)=>{const r=new i;function o(){r.onload=null,r.onerror=null}r.onload=()=>{o(),e(r)},r.onerror=t=>{o(),n(t)},r.src=t})},backends:u.Backends,version:a.version,cairoVersion:u.cairoVersion,jpegVersion:u.jpegVersion,gifVersion:u.gifVersion?u.gifVersion.replace(/[^.\d]/g,""):void 0,freetypeVersion:u.freetypeVersion}},function(t,e,n){"use strict";
/*!
 * Canvas
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const r=n(1),i=t.exports=r.Canvas,o=n(4),s=n(6),a=n(7),u=n(8),c=["image/png","image/jpeg"],h=n(0);i.prototype[h.inspect.custom||"inspect"]=function(){return`[Canvas ${this.width}x${this.height}]`},i.prototype.getContext=function(t,e){if("2d"==t){var n=this._context2d||(this._context2d=new o(this,e));return this.context=n,n.canvas=this,n}},i.prototype.pngStream=i.prototype.createPNGStream=function(t){return new s(this,t)},i.prototype.pdfStream=i.prototype.createPDFStream=function(t){return new a(this,t)},i.prototype.jpegStream=i.prototype.createJPEGStream=function(t){return new u(this,t)},i.prototype.toDataURL=function(t,e,n){var r,i="image/png",o={};if("function"==typeof t)r=t;else if("string"==typeof t&&c.includes(t.toLowerCase())&&(i=t.toLowerCase()),"function"==typeof e)r=e;else if("object"==typeof e?o=e:"number"==typeof e&&(o={quality:Math.max(0,Math.min(1,e))}),"function"==typeof n)r=n;else if(void 0!==n)throw new TypeError(typeof n+" is not a function");if(0===this.width||0===this.height){return r?void setTimeout(()=>r(null,"data:,")):"data:,"}if(!r)return`data:${i};base64,${this.toBuffer(i,o).toString("base64")}`;this.toBuffer((t,e)=>{if(t)return r(t);r(null,`data:${i};base64,${e.toString("base64")}`)},i,o)}},function(t,e,n){(function(t){try{global.process.dlopen(t,"/Users/guoxiaodong/Documents/App/@github/mcanvas/node_modules/canvas/build/Release/canvas.node")}catch(t){throw new Error("Cannot open /Users/guoxiaodong/Documents/App/@github/mcanvas/node_modules/canvas/build/Release/canvas.node: "+t)}}).call(this,n(14)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";
/*!
 * Canvas - Image
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const r=n(1),i=t.exports=r.Image,o=n(0);let s;const{GetSource:a,SetSource:u}=r;function c(t,e,n){u.call(t,e),t._originalSource=n}Object.defineProperty(i.prototype,"src",{set(t){if("string"==typeof t)if(/^\s*data:/.test(t)){const e=t.indexOf(","),n=-1!==t.lastIndexOf("base64",e),r=t.slice(e+1);c(this,Buffer.from(r,n?"base64":"utf8"),t)}else if(/^\s*https?:\/\//.test(t)){const e=t=>{if("function"!=typeof this.onerror)throw t;this.onerror(t)};s||(s=n(16)),s.concat(t,(t,n,r)=>t?e(t):n.statusCode<200||n.statusCode>=300?e(new Error("Server responded with "+n.statusCode)):void c(this,r))}else c(this,t);else Buffer.isBuffer(t)&&c(this,t)},get(){return(t=this)._originalSource||a.call(t);var t},configurable:!0}),i.prototype[o.inspect.custom||"inspect"]=function(){return"[Image"+(this.complete?":"+this.width+"x"+this.height:"")+(this.src?" "+this.src:"")+(this.complete?" complete":"")+"]"}},function(t,e,n){t.exports=f;const r=n(17),i=n(18),o=n(21),s=n(22),a=n(23),u=n(25),c=n(26),h=t=>null!==t&&"object"==typeof t&&"function"==typeof t.pipe;function f(t,e){if(t=Object.assign({maxRedirects:10},"string"==typeof t?{url:t}:t),e=a(e),t.url){const{hostname:e,port:n,protocol:r,auth:i,path:o}=c.parse(t.url);delete t.url,e||n||r||i?Object.assign(t,{hostname:e,port:n,protocol:r,auth:i,path:o}):t.path=o}const n={"accept-encoding":"gzip, deflate"};let r;t.headers&&Object.keys(t.headers).forEach(e=>n[e.toLowerCase()]=t.headers[e]),t.headers=n,t.body?r=t.json&&!h(t.body)?JSON.stringify(t.body):t.body:t.form&&(r="string"==typeof t.form?t.form:u.stringify(t.form),t.headers["content-type"]="application/x-www-form-urlencoded"),r&&(t.method||(t.method="POST"),h(r)||(t.headers["content-length"]=Buffer.byteLength(r)),t.json&&!t.form&&(t.headers["content-type"]="application/json")),delete t.body,delete t.form,t.json&&(t.headers.accept="application/json"),t.method&&(t.method=t.method.toUpperCase());const p=("https:"===t.protocol?s:o).request(t,n=>{if(!1!==t.followRedirects&&n.statusCode>=300&&n.statusCode<400&&n.headers.location)return t.url=n.headers.location,delete t.headers.host,n.resume(),"POST"===t.method&&[301,302].includes(n.statusCode)&&(t.method="GET",delete t.headers["content-length"],delete t.headers["content-type"]),0==t.maxRedirects--?e(new Error("too many redirects")):f(t,e);const r="function"==typeof i&&"HEAD"!==t.method;e(null,r?i(n):n)});return p.on("timeout",()=>{p.abort(),e(new Error("Request timed out"))}),p.on("error",e),h(r)?r.on("error",e).pipe(p):p.end(r),p}f.concat=(t,e)=>f(t,(n,i)=>{if(n)return e(n);r(i,(n,r)=>{if(n)return e(n);if(t.json)try{r=JSON.parse(r.toString())}catch(n){return e(n,i,r)}e(null,i,r)})}),["get","post","put","patch","head","delete"].forEach(t=>{f[t]=(e,n)=>("string"==typeof e&&(e={url:e}),f(Object.assign({method:t.toUpperCase()},e),n))})},function(t,e){t.exports=function(t,e){var n=[];t.on("data",(function(t){n.push(t)})),t.once("end",(function(){e&&e(null,Buffer.concat(n)),e=null})),t.once("error",(function(t){e&&e(t),e=null}))}},function(t,e,n){"use strict";const{PassThrough:r}=n(2),i=n(19),o=n(20),s=t=>{const e=(t.headers["content-encoding"]||"").toLowerCase();if(!["gzip","deflate","br"].includes(e))return t;const n="br"===e;if(n&&"function"!=typeof i.createBrotliDecompress)return t;const s=n?i.createBrotliDecompress():i.createUnzip(),a=new r;return o(t,a),s.on("error",t=>{"Z_BUF_ERROR"!==t.code?a.emit("error",t):a.end()}),t.pipe(s).pipe(a),a};t.exports=s,t.exports.default=s},function(t,e){t.exports=require("zlib")},function(t,e,n){"use strict";const r=["aborted","complete","destroy","headers","httpVersion","httpVersionMinor","httpVersionMajor","method","rawHeaders","rawTrailers","setTimeout","socket","statusCode","statusMessage","trailers","url"];t.exports=(t,e)=>{const n=new Set(Object.keys(t).concat(r));for(const r of n)r in e||(e[r]="function"==typeof t[r]?t[r].bind(t):t[r]);return e}},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e,n){var r=n(24);function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},n=t.name||"Function wrapped with `once`";return e.onceError=n+" shouldn't be called more than once",e.called=!1,e}t.exports=r(i),t.exports.strict=r(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},function(t,e){t.exports=function t(e,n){if(e&&n)return t(e)(n);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach((function(t){r[t]=e[t]})),r;function r(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];var r=e.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(t){r[t]=i[t]})),r}}},function(t,e){t.exports=require("querystring")},function(t,e){t.exports=require("url")},function(t){t.exports=JSON.parse('{"_from":"canvas","_id":"canvas@2.6.1","_inBundle":false,"_integrity":"sha512-S98rKsPcuhfTcYbtF53UIJhcbgIAK533d1kJKMwsMwAIFgfd58MOyxRud3kktlzWiEkFliaJtvyZCBtud/XVEA==","_location":"/canvas","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"canvas","name":"canvas","escapedName":"canvas","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/canvas/-/canvas-2.6.1.tgz","_shasum":"0d087dd4d60f5a5a9efa202757270abea8bef89e","_spec":"canvas","_where":"/Users/guoxiaodong/Documents/App/@github/mcanvas","author":{"name":"TJ Holowaychuk","email":"tj@learnboost.com"},"binary":{"module_name":"canvas","module_path":"build/Release","host":"https://github.com/node-gfx/node-canvas-prebuilt/releases/download/","remote_path":"v{version}","package_name":"{module_name}-v{version}-{node_abi}-{platform}-{libc}-{arch}.tar.gz"},"browser":"browser.js","bugs":{"url":"https://github.com/Automattic/node-canvas/issues"},"bundleDependencies":false,"contributors":[{"name":"Nathan Rajlich","email":"nathan@tootallnate.net"},{"name":"Rod Vagg","email":"r@va.gg"},{"name":"Juriy Zaytsev","email":"kangax@gmail.com"}],"dependencies":{"nan":"^2.14.0","node-pre-gyp":"^0.11.0","simple-get":"^3.0.3"},"deprecated":false,"description":"Canvas graphics API backed by Cairo","devDependencies":{"@types/node":"^10.12.18","assert-rejects":"^1.0.0","dtslint":"^0.5.3","express":"^4.16.3","mocha":"^5.2.0","pixelmatch":"^4.0.2","standard":"^12.0.1"},"engines":{"node":">=6"},"files":["binding.gyp","lib/","src/","util/","types/index.d.ts"],"homepage":"https://github.com/Automattic/node-canvas","keywords":["canvas","graphic","graphics","pixman","cairo","image","images","pdf"],"license":"MIT","main":"index.js","name":"canvas","repository":{"type":"git","url":"git://github.com/Automattic/node-canvas.git"},"scripts":{"benchmark":"node benchmarks/run.js","dtslint":"dtslint types","install":"node-pre-gyp install --fallback-to-build","prebenchmark":"node-gyp build","pretest":"standard examples/*.js test/server.js test/public/*.js benchmarks/run.js lib/context2d.js util/has_lib.js browser.js index.js && node-gyp build","pretest-server":"node-gyp build","test":"mocha test/*.test.js","test-server":"node test/server.js"},"types":"types/index.d.ts","version":"2.6.1"}')},function(t,e){t.exports=require("fs")},function(t,e,n){"use strict";n.r(e),n.d(e,"MCompose",(function(){return x})),n.d(e,"MImage",(function(){return P}));var r={};function i(t){var e=r.toString.call(t);return null===t?t+"":Number.isNaN(t)?"NaN":"object"==typeof t||"function"==typeof t?r[e]||"object":typeof t}"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach((function(t){r["[object "+t+"]"]=t.toLowerCase()}));var o={primitive:function(t){return["string","number"].includes(i(t))},array:function(t){return"array"===i(t)},str:function(t){return"string"===i(t)},obj:function(t){return"object"===i(t)},arr:function(t){return"array"===i(t)},num:function(t){return"number"===i(t)},fn:function(t){return"function"===i(t)},undef:function(t){return"undefined"===i(t)},def:function(t){return!o.undef(t)},null:function(t){return"null"===i(t)},empty:function(t){switch(i(t)){case"object":return 0===Object.keys(t).length;case"array":return 0===t.length;case"string":return!t.trim();case"undefined":case"null":case"NaN":case"boolean":return!0;default:return!1}},Nil:function(t){return["null","undefined"].includes(i(t))},NaN:function(t){return"NaN"===i(t)},promise:function(t){return!!t&&(o.obj(t)||o.fn(t))&&o.fn(t.then)}},s=n(10)._Canvas;function a(t){var e={},n=e.toString,r=e.hasOwnProperty,i=r.toString,o=i.call(Object);if(!t||"[object Object]"!==n.call(t))return!1;var s=Object.getPrototypeOf(t);if(!s)return!0;var a=r.call(s,"constructor")&&s.constructor;return"function"==typeof a&&i.call(a)===o}function u(){for(var t,e,n,r,i,o,s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];var h=arguments[0]||{},f=1,p=arguments.length,l=!1;for("boolean"==typeof h&&(l=h,h=arguments[f]||{},f++),"object"!=typeof h&&"function"!=typeof h&&(h={}),f===p&&(h=this,f--);f<p;f++)if(null!==(t=arguments[f]))for(e in t)if(t.hasOwnProperty(e)){if(i=h[e],h===(r=t[e]))continue;l&&r&&(a(r)||(o=Array.isArray(r)))?(o?(o=!1,n=i&&Array.isArray(i)?i:[]):n=i&&a(i)?i:{},h[e]=u(l,n,r)):void 0!==r&&(h[e]=r)}return h}function c(t,e,n,r,i,o,s,a,u){void 0===o&&(o=0),void 0===s&&(s="#fff"),void 0===a&&(a=0),void 0===u&&(u="#000");var c=Math.min(r,i);2*o>c&&(o=c/2),t.save(),t.translate(e,n),function(t,e,n,r){t.beginPath(),t.arc(e-r,n-r,r,0,Math.PI/2),t.lineTo(r,n),t.arc(r,n-r,r,Math.PI/2,Math.PI),t.lineTo(0,r),t.arc(r,r,r,Math.PI,3*Math.PI/2),t.lineTo(e-r,0),t.arc(e-r,r,r,3*Math.PI/2,2*Math.PI),t.lineTo(e,n-r),t.closePath()}(t,r,i,o),t.fillStyle=s,t.fill(),t.lineWidth=a,t.strokeStyle=u,t.stroke(),t.restore()}function h(t,e,n){"string"==typeof t?s.loadImage(t,e,n):"object"==typeof t?e(t):m("getImage error, src="+t)}function f(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function p(t){var e,n;return"IMG"===t.tagName?(e=t.naturalWidth,n=t.naturalHeight):(!function(t){t.tagName}(t),e=t.width,n=t.height),{iw:e,ih:n}}function l(t,e){return t.indexOf&&-1!==t.indexOf(e)}function d(t,e,n,r){var i=n;if(o.str(n))if(l(n,":")&&"pos"===r){var s=n.split(":"),a=s[0],u=s[1];switch(a){case"left":case"top":i=+u.replace("px","");break;case"right":case"bottom":i=t-+u.replace("px","")-e}}else i=l(n,"px")?+n.replace("px",""):l(n,"%")?("crop"===r?e:t)*+n.replace("%","")/100:l(["top","left"],n)?0:l(["bottom","right"],n)?t-e:"center"===n?(t-e)/2:"origin"===n?e:+n;return Math.round(i)}function v(t,e){var n=e;return o.str(e)&&(n=l(e,"px")?+e.replace("px",""):l(e,"%")?t*+e.replace("%","")/100:"center"===e?t/2:+e),Math.round(n)}function g(t){throw new Error("[MCanvas ERROR]: "+t)}function m(t){throw new Error("[MCanvas WARN]: "+t)}function y(t,e){var n=p(t),r=n.iw,i=n.ih,o=u(!0,{x:0,y:0,width:"100%",height:"100%",radius:0},e),a=o.width,h=o.height,f=o.x,l=o.y,g=o.radius;(a=v(r,a))>r&&(a=r),(h=v(i,h))>i&&(h=i),f=d(r,a,f,"pos"),l=d(i,h,l,"pos"),g=v(r,g);var m=s.create(a,h),y=m[0],x=m[1];return y.width=a,y.height=h,c(x,0,0,a,h,g),x.globalCompositeOperation="source-in",x.drawImage(t,-f,-l,r,i),{cvs:y,ctx:x}}var x=function(){function t(t){void 0===t&&(t={}),this.queue=[],this.fn={success:function(){},error:function(t){}},this.data={textId:0,text:{},bgConfig:null},this._defaultFontFamily="helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif",this.ops=u({width:500,height:500,backgroundColor:""},t),this._init()}return t.prototype._init=function(){var t,e=this.ops,n=e.width,r=e.height,i=e.backgroundColor;t=s.create(n,r),this.cvs=t[0],this.ctx=t[1],i&&this._setBgColor(i)},t.prototype.background=function(t,e){var n=this;return void 0===e&&(e={type:"origin"}),t||this.data.bgConfig?(t?(e.image=t,this.data.bgConfig=e):this.data.bgConfig&&(e=this.data.bgConfig),this.queue.push((function(){e.color&&n._setBgColor(e.color),h(e.image,(function(t){return n._background(t,e)}),n.fn.error)})),this):(g("the init background must has a image."),this)},t.prototype._setBgColor=function(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.cvs.width,this.cvs.height)},t.prototype._getBgAlign=function(t,e,n,r){var i;return o.str(t)?"50%"===t||"center"===t?i=Math.abs((e-n/r)/2):"100%"===t?i=Math.abs(e-n/r):"0%"===t&&(i=0):i=o.num(t)?t:0,i},t.prototype._background=function(t,e){var n,r,i,o,s,a,u,c,h,f=p(t),l=f.iw,d=f.ih,v=l/d,m=this.cvs.width/this.cvs.height;switch(e.type){case"crop":v>m?(i=d*m,o=d,h=this.cvs.height/d):(o=(i=l)/m,h=this.cvs.width/l),n=this._getBgAlign(e.left,l,this.cvs.width,h),r=this._getBgAlign(e.top,d,this.cvs.height,h),a=s=0,c=this.cvs.height,u=this.cvs.width;break;case"contain":r=n=0,i=l,o=d,v>m?(c=(u=this.cvs.width)/v,s=e.left||0,a=e.top||0===e.top?e.top:(this.cvs.height-c)/2):(u=(c=this.cvs.height)*v,a=e.top||0,s=e.left||0===e.left?e.left:(this.cvs.width-u)/2);break;case"origin":this.cvs.width=l,this.cvs.height=d,n=r=0,i=l,o=d,s=a=0,u=this.cvs.width,c=this.cvs.height;break;default:return void g("background type error!")}this.ctx.drawImage(t,n,r,i,o,s,a,u,c),this._next()},t.prototype.rect=function(t){var e=this;return this.queue.push((function(){var n=e.cvs,r=n.width,i=n.height,o=t.fillColor,s=void 0===o?"#fff":o,a=t.strokeColor,u=void 0===a?s:a,h=t.strokeWidth,f=void 0===h?0:h,p=t.radius,v=void 0===p?0:p,g=t.width,m=void 0===g?0:g,y=t.height,x=void 0===y?0:y,w=t.x,b=void 0===w?0:w,_=t.y,S=void 0===_?0:_;m=d(r,0,m,"pos")-2*f,x=d(i,0,x,"pos")-2*f,b=d(r,m,b,"pos")+(l(b,"right")?-f:f),S=d(i,x,S,"pos")+(l(S,"bottom")?-f:f),c(e.ctx,b,S,m,x,v,s,f,u),e._resetCtx()._next()})),this},t.prototype.circle=function(t){var e=this;return this.queue.push((function(){var n=t.fillColor,r=void 0===n?"#fff":n,i=t.strokeColor,o=void 0===i?r:i,s=t.strokeWidth,a=void 0===s?0:s,u=e.cvs,c=u.width,h=u.height,f=d(c,0,t.r||0,"pos")-2*a,p=t.x,v=void 0===p?0:p,g=t.y,m=void 0===g?0:g;v=d(c,2*f,v,"pos")+f+(l(v,"right")?-a:a),m=d(h,2*f,m,"pos")+f+(l(m,"bottom")?-a:a),e.ctx.beginPath(),e.ctx.arc(v,m,f,0,2*Math.PI,!1),e.ctx.fillStyle=r,e.ctx.fill(),e.ctx.strokeStyle=o,e.ctx.lineWidth=a,e.ctx.stroke(),e.ctx.closePath(),e._resetCtx()._next()})),this},t.prototype._resetCtx=function(){return this.ctx.setTransform(1,0,0,1,0,0),this},t.prototype.watermark=function(t,e){if(!t)return g("there is not image of watermark."),this;var n=e.width,r=void 0===n?"40%":n,i=e.pos,o=void 0===i?"rightbottom":i,s=e.margin,a=void 0===s?20:s,u={x:0,y:0,scale:1,rotate:0};switch(o){case"leftTop":u.x="left:"+a,u.y="top:"+a;break;case"leftBottom":u.x="left:"+a,u.y="bottom:"+a;break;case"rightTop":u.x="right:"+a,u.y="top:"+a;break;case"rightBottom":u.x="right:"+a,u.y="bottom:"+a}return this.add(t,{width:r,pos:u}),this},t.prototype.add=function(t,e){var n=this,r={width:"100%",crop:{x:0,y:0,width:"100%",height:"100%",radius:0},pos:{x:0,y:0,scale:1,rotate:0}};return(o.arr(t)?t:[{image:t,options:e}]).map((function(t){var e=t.image,i=t.options;n.queue.push((function(){h(e,(function(t){n._add(t,n._handleOps(t,u(!0,r,i)))}),n.fn.error)}))})),this},t.prototype._add=function(t,e){var n,r=e.crop,i=e.pos,o=e.width;0===o&&m("the width of mc-element is zero");var a,u,c,h,f=p(t),l=f.iw,d=f.ih,v=r.width,g=r.height,x=r.radius;(v!==l||g!==d||x>0)&&(t=y(t,r).cvs);var w,b,_,S,M,C,j=v/g,k=l>d?l/d:d/l,I=1.4*k>5?5:1.4*k,D=s.create(Math.round(v*I),Math.round(g*I)),P=D[0],O=D[1],E=function(){if("undefined"==typeof window)return!1;var t=window.navigator.userAgent.toLowerCase(),e=/(iPhone|iPad|iPod|iOS)/gi.test(t),n=/(iPad)/gi.test(t);if(e){var r=n?t.match(/cpu os (\d*)/):t.match(/iphone os (\d*)/);return!!(r&&+r[1]<9)}return!1}()&&(P.width>2096||P.height>2096)?2096:4096,T=j>1?E/P.width:E/P.height;w=-Math.round(v/2),b=-Math.round(g/2),_=v,S=Math.round(v/j),(P.width>E||P.height>E)&&T&&(n=[P.width,P.height,w,b,_,S].map((function(t){return Math.round(t*T)})),P.width=n[0],P.height=n[1],w=n[2],b=n[3],_=n[4],S=n[5]),O.translate(P.width/2,P.height/2),O.rotate(i.rotate),O.drawImage(t,w,b,_,S),c=Math.round(o*I),h=Math.round(c/j),C=(M=(I-1)*o/2)/j,a=Math.round(i.x+c*(1-i.scale)/2-M),u=Math.round(i.y+h*(1-i.scale)/2-C),c*=i.scale,h*=i.scale,this.ctx.drawImage(P,a,u,c,h),this._next()},t.prototype._getRotate=function(t){return o.str(t)?parseFloat(t)*Math.PI/180:o.num(t)?t*Math.PI/180:0},t.prototype._handleOps=function(t,e){var n,r,i=this.cvs,o=i.width,s=i.height,a=p(t),u=a.iw,c=a.ih,h=u/c,f=d(o,u,e.width,"pos"),l=d(o,u,e.crop.width,"crop"),g=d(s,c,e.crop.height,"crop"),m={width:l,height:g,x:d(u,l,e.crop.x,"crop"),y:d(c,g,e.crop.y,"crop"),radius:v(l,e.crop.radius)};m.x>u&&(m.x=u),m.y>c&&(m.y=c),n=u-m.x,r=c-m.y,m.width>n&&(m.width=n),m.height>r&&(m.height=r);var y=e.pos,x=y.x,w=y.y,b=y.rotate,_=y.scale,S=void 0===_?1:_;return{width:f,crop:m,pos:{x:d(o,f,x,"pos"),y:d(s,f/h,w,"pos"),scale:S,rotate:this._getRotate(b)}}},t.prototype._createStyle=function(t,e){return{font:t+"px "+this._defaultFontFamily,lineHeight:e,color:"#000",type:"fill",lineWidth:1,shadow:{color:null,blur:0,offsetX:0,offsetY:0}}},t.prototype.text=function(t,e){var n=this;void 0===t&&(t="");var r=this.cvs.width/20;return this.queue.push((function(){var i,o=u(!0,{width:300,align:"left",smallStyle:n._createStyle(.8*r,.9*r),normalStyle:n._createStyle(r,1.1*r),largeStyle:n._createStyle(1.3*r,1.4*r),pos:{x:0,y:0,rotate:0}},e),s=n._parse(t),a=0;s.map((function(t){t.size>a&&(a=t.size,i=t.type)}));var c=parseInt(o[i+"Style"].font);c&&o.width<c&&(o.width=c),n._text(s,o),n._resetCtx()._next()})),this},t.prototype._parse=function(t){for(var e=t.split(/<s>|<b>/),n=[],r=0;r<e.length;r++){var i=e[r];if(/<\/s>|<\/b>/.test(i)){var o=/<\/s>/.test(i)?"</s>":"</b>",s=/<\/s>/.test(i)?"small":"large",a=e[r].split(o);n.push({type:s,text:a[0],size:"small"===s?0:2}),a[1]&&n.push({type:"normal",text:a[1],size:1})}else e[r]&&n.push({text:e[r],type:"normal",size:1})}return n},t.prototype._text=function(t,e){var n=this;this.data.textId++,this.data.text[this.data.textId]={};var r,i=e.width=d(this.cvs.width,0,e.width,"pos"),o=1,a=0,u=this._getLineHeight(t,e),c=d(this.cvs.width,i,0,"pos"),h=d(this.cvs.height,0,0,"pos")+u;this.data.text[this.data.textId][o]={data:[],lineWidth:0},t.map((function(t){r=e[t.type+"Style"],n.ctx.font=r.font;var s=n.ctx.measureText(t.text).width,f=t.text.replace(/<br>/g,"|");if(a+s>i||l(f,"|"))for(var p=0,d=f.length;p<d;p++){var v,g=f[p];if(s=n.ctx.measureText(g).width,!(a+s>i||"|"===g)||(c=a=0,h+=u,o+=1,n.data.text[n.data.textId][o]={data:[],lineWidth:0},"|"!==g))(v=n.data.text[n.data.textId][o]).data.push({context:g,x:c,y:h,style:r,width:s}),c+=s,v.lineWidth=a+=s}else(v=n.data.text[n.data.textId][o]).data.push({context:f,x:c,y:h,style:r,width:s}),c+=s,v.lineWidth=a+=s}));var p=s.create(i,this._getTextRectHeight(o)),v=p[0],g=p[1],m=v.height,y=v.width,x=d(this.cvs.width,y,e.pos.x,"pos"),w=d(this.cvs.height,m,e.pos.y,"pos");f(this.data.text[this.data.textId],(function(t,r){var o=0;r.lineWidth<i&&("center"===e.align?o=(i-r.lineWidth)/2:"right"===e.align&&(o=i-r.lineWidth)),r.data.map((function(t){t.x+=o,n._fillText(g,t)}))})),this.ctx.translate(x+y/2,w+m/2),this.ctx.rotate(this._getRotate(e.pos.rotate)),this.ctx.drawImage(v,-y/2,-m/2,y,m)},t.prototype._getLineHeight=function(t,e){var n,r=0;return t.map((function(t){(n=e[t.type+"Style"].lineHeight)>r&&(r=n)})),r},t.prototype._fillText=function(t,e){var n=e.context,r=e.x,i=e.y,o=e.style,s=o.align,a=o.lineWidth,u=o.shadow,c=o.font,h=o.gradient,p=o.lineHeight,l=u.color,d=u.blur,v=u.offsetX,g=u.offsetY;if(t.font=c,t.textAlign=s,t.textBaseline="alphabetic",t.lineWidth=a,t.shadowColor=l,t.shadowBlur=d,t.shadowOffsetX=v,t.shadowOffsetY=g,h){var m=h.type,y=h.colorStop,x=void 0,w=void 0,b=void 0,_=void 0;1===m?(x=r,w=i,b=r+e.width,_=i):(x=r,w=i-p,b=r,_=i);var S=t.createLinearGradient(x,w,b,_),M=y.length||0;f(y,(function(t,e){S.addColorStop(1/M*(+t+1),e)})),t[o.type+"Style"]=S}else t[o.type+"Style"]=o.color;t[o.type+"Text"](n,r,i),this._resetCtx()},t.prototype._getTextRectHeight=function(t){var e=this.data.text[this.data.textId][t].data[0];return e.y+e.style.lineHeight},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(n,r){var i={type:"jpeg",quality:.9,exportType:"base64",success:function(t){},error:function(t){}};o.fn(t)?i.success=t:"jpg"===(i=u(!0,i,t)).type&&(i.type="jpeg"),e.fn.error=function(t){i.error(t),r(t)},e.fn.success=function(){"canvas"===i.exportType?(i.success(e.cvs),n(e.cvs)):setTimeout((function(){var t=e.cvs.toDataURL("image/"+i.type,i.quality);i.success(t),n(t)}),0)},e._next()}))},t.prototype._next=function(){if(this.queue.length>0){this.ctx.save();var t=this.queue.shift();t&&t(),this.ctx.restore()}else this.fn.success()},t.prototype.clear=function(){return this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function w(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function b(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function _(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}Object.create;var S=function(){function t(t){var e=this;this.isFirst=!0,this.queue=[],this._next=function(t){if(e.isFirst||(t=e.after(t)),e.queue.length>0){var n=e.queue.shift();n&&(t=e.before(t),n(e._next,t),e.isFirst=!1)}else e.end(t),e.queue=[]};var n=t||{},r=n.before,i=void 0===r?function(t){return t}:r,o=n.after,s=void 0===o?function(t){return t}:o;this.before=i,this.after=s}return t.prototype.push=function(t){o.fn(t)&&this.queue.push(t)},t.prototype.perform=function(t,e){this.end=t,this._next(e)},t}();function M(t,e,n,r,i){var o,s,a,u,c,h,f,p,l,d,v,g,m,y,x=2*i+1,w=i+1,b=n-1,_=0,S=[];for(l=0,d=256*x;l<d;l+=1)S[l]=l/x|0;for(g=0;g<r;g+=1){for(o=s=a=u=0,c=g,o+=w*t[h=_<<2],s+=w*t[h+1],a+=w*t[h+2],u+=w*t[h+3],l=1;l<=i;l+=1)o+=t[h=_+(l<n?l:b)<<2],s+=t[h+1],a+=t[h+2],u+=t[h+3];for(v=0;v<n;v+=1)e[h=c<<2]=S[o],e[h+1]=S[s],e[h+2]=S[a],e[h+3]=S[u],(m=v+w)>b&&(m=b),(y=v-i)<0&&(y=0),p=_+y<<2,o+=t[f=_+m<<2]-t[p],s+=t[f+1]-t[p+1],a+=t[f+2]-t[p+2],u+=t[f+3]-t[p+3],c+=r;_+=n}}function C(t,e){void 0===e&&(e=6);for(var n=t.width,r=t.height,i=t.getContext("2d"),o=i.getImageData(0,0,n,r).data,s=i.createImageData(n,r),a=s.data,u=i.createImageData(n,r).data,c=0;c<e;c+=1)M(c?a:o,u,n,r,2),M(u,a,n,r,2);return i.putImageData(s,0,0),[t,i]}function j(t,e){void 0===e&&(e="hor");var n,r,i,o,s=t.width,a=t.height,u=t.getContext("2d"),c=u.getImageData(0,0,s,a).data,h=u.createImageData(s,a),f=h.data;for(n=0;n<a;n++)for(r=0;r<s;r++)i=4*(n*s+r),f[o="hor"===e?4*(n*s+(s-r-1)):4*((a-n-1)*s+r)]=c[i],f[o+1]=c[i+1],f[o+2]=c[i+2],f[o+3]=c[i+3];return u.putImageData(h,0,0),[t,u]}function k(t){var e,n,r=t.width,i=t.height,o=t.getContext("2d"),s=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),u=a.data;for(e=0;e<s.length;e+=4)n=.3*s[e]+.59*s[e+1]+.11*s[e+2],u[e]=u[e+1]=u[e+2]=n,u[e+3]=s[e+3];return o.putImageData(a,0,0),[t,o]}function I(t,e){void 0===e&&(e=10);var n,r,i,o,s,a,u,c,h,f,p,l,d,v,g,m=t.width,y=t.height,x=t.getContext("2d"),w=x.getImageData(0,0,m,y).data,b=x.createImageData(m,y),_=b.data,S=Math.ceil(m/e),M=Math.ceil(y/e);for(n=0;n<M;n++)for((a=(s=n*e)+e)>y&&(a=y),r=0;r<S;r++){for((o=(i=r*e)+e)>m&&(o=m),l=d=v=g=0,p=(o-i)*(a-s),c=s;c<a;c+=1)for(h=c*m,u=i;u<o;u+=1)l+=w[f=h+u<<2],d+=w[f+1],v+=w[f+2],g+=w[f+3];for(l=l/p+.5|0,d=d/p+.5|0,v=v/p+.5|0,g=g/p+.5|0,c=s;c<a;c++)for(h=c*m,u=i;u<o;u++)_[f=h+u<<2]=l,_[f+1]=d,_[f+2]=v,_[f+3]=g}return x.putImageData(b,0,0),[t,x]}function D(t,e,n){void 0===e&&(e=2),void 0===n&&(n=32);var r,i,o,s,a,u,c,h,f,p,l,d,v,g,m,y,x,w,b=t.width,_=t.height,S=t.getContext("2d"),M=S.getImageData(0,0,b,_).data,C=S.createImageData(b,_),j=C.data,k=[],I=[],D=[],P=[],O=[],E=[],T=0;for(u=0;u<_;u++)for(a=0;a<b;a++){for(c=0;c<n;c++)k[c]=I[c]=D[c]=P[c]=O[c]=E[c]=0;for(h=-e;h<=e;h++)if(!((r=u+h)<0||r>=_))for(o=r*b,f=-e;f<=e;f++)(i=a+f)<0||i>=b||(p=M[s=o+i<<2],g=(l=M[s+1])*n>>8,m=(d=M[s+2])*n>>8,P[v=p*n>>8]+=p,O[g]+=l,E[m]+=d,k[v]+=1,I[g]+=1,D[m]+=1);for(y=x=w=0,c=1;c<n;c++)k[c]>k[y]&&(y=c),I[c]>I[x]&&(x=c),D[c]>D[w]&&(w=c);j[T]=P[y]/k[y]|0,j[T+1]=O[x]/I[x]|0,j[T+2]=E[w]/D[w]|0,j[T+3]=M[T+3],T+=4}return S.putImageData(C,0,0),[t,S]}var P=function(){function t(t){this._image=t,this._queue=new S,this.clear()}return t.prototype.clear=function(){this._getImage()._drawCanvas()},t.prototype._drawCanvas=function(){return this._run((function(t){var e=p(t),n=e.iw,r=e.ih,i=s.create(n,r),o=i[0],a=i[1];return a.drawImage(t,0,0,n,r),{cvs:o,ctx:a}}))},t.prototype._getImage=function(){var t=this;return this._run((function(){return new Promise((function(e){o.str(t._image)?h(t._image,(function(n){e(t._image=n)}),t._error):e(t._image)}))}))},t.prototype._run=function(t){var e=this;return this._queue.push((function(n,r){setTimeout((function(){return w(e,void 0,void 0,(function(){var e;return b(this,(function(i){return e=t(r),o.promise(e)?e.then(n):n(e),[2]}))}))}),0)})),this},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(n,r){var i={type:"jpeg",quality:1,exportType:"base64",success:function(t){},error:function(t){}};o.fn(t)?i.success=t:"jpg"===(i=u(!0,i,t)).type&&(i.type="jpeg");var s=function(t){i.success(t),n(t)};e._error=function(t){i.error(t),r(t)},e._queue.perform((function(t){var e=t.cvs;"canvas"===i.exportType?s(e):setTimeout((function(){var t=e.toDataURL("image/"+i.type,i.quality);s(t)}),0)}))}))},t.prototype.crop=function(t){return this._run((function(e){return y(e.cvs,t)}))},t.prototype.compress=function(t){return void 0===t&&(t={}),this.draw(t)},t.prototype.filter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this._run((function(n){var r,i,o,s,a,u=n.cvs,c=u,h=n.ctx;switch(t){case"blur":c=(r=C.apply(void 0,_([u],e)))[0],h=r[1];break;case"flip":c=(i=j.apply(void 0,_([u],e)))[0],h=i[1];break;case"gray":c=(o=k(u))[0],h=o[1];break;case"mosaic":c=(s=I.apply(void 0,_([u],e)))[0],h=s[1];break;case"oil":c=(a=D.apply(void 0,_([u],e)))[0],h=a[1]}return{cvs:c,ctx:h}}))},t}();e.default=x}])}));