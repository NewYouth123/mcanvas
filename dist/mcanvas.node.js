!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MCanvas=e():t.MCanvas=e()}(global,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e){t.exports=require("util")},function(t,e,r){"use strict";t.exports=r(13)},function(t,e){t.exports=require("stream")},function(t,e,r){"use strict";const n=r(0);function i(t,e,r,n){if(!(this instanceof i))throw new TypeError("Class constructors cannot be invoked without 'new'");"object"==typeof t&&(n=t.w,r=t.z,e=t.y,t=t.x),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.z="number"==typeof r?r:0,this.w="number"==typeof n?n:1}const o=180/Math.PI,s=Math.PI/180;function a(t){var e=t.split(/\(/,1)[0];switch(e){case"matrix":return function(t){var e=t.replace(/matrix\(/,"");if(6!==(e=e.split(/,/,7)).length)throw new Error("Failed to parse "+t);return[(e=e.map(parseFloat))[0],e[1],0,0,e[2],e[3],0,0,0,0,1,0,e[4],e[5],0,1]}(t);case"matrix3d":return function(t){var e=t.replace(/matrix3d\(/,"");if(16!==(e=e.split(/,/,17)).length)throw new Error("Failed to parse "+t);return e.map(parseFloat)}(t);default:throw new Error(e+" parsing not implemented")}}function u(t){if(!(this instanceof u))throw new TypeError("Class constructors cannot be invoked without 'new'");var e;if(this._is2D=!0,this._values=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),"string"==typeof t){if(""===t)return;var r=t.split(/\)\s+/,20).map(a);if(0===r.length)return;for(t=r[0],e=1;e<r.length;e++)t=l(r[e],t)}if(e=0,t&&6===t.length)c(this,0,t[e++]),c(this,1,t[e++]),c(this,4,t[e++]),c(this,5,t[e++]),c(this,12,t[e++]),c(this,13,t[e++]);else if(t&&16===t.length)c(this,0,t[e++]),c(this,1,t[e++]),h(this,2,t[e++]),h(this,3,t[e++]),c(this,4,t[e++]),c(this,5,t[e++]),h(this,6,t[e++]),h(this,7,t[e++]),h(this,8,t[e++]),h(this,9,t[e++]),h(this,10,t[e++]),h(this,11,t[e++]),c(this,12,t[e++]),c(this,13,t[e++]),h(this,14,t[e++]),h(this,15,t[e]);else if(void 0!==t)throw new TypeError("Expected string or array.")}function c(t,e,r){if("number"!=typeof r)throw new TypeError("Expected number");return t._values[e]=r}function h(t,e,r){if("number"!=typeof r)throw new TypeError("Expected number");return 10===e||15===e?1!==r&&(t._is2D=!1):0!==r&&(t._is2D=!1),t._values[e]=r}function f(t){var e=Object.create(u.prototype);return e.constructor=u,e._is2D=!0,e._values=t,e}function l(t,e){for(var r=new Float64Array(16),n=0;n<4;n++)for(var i=0;i<4;i++){for(var o=0,s=0;s<4;s++)o+=t[4*n+s]*e[4*s+i];r[4*n+i]=o}return r}u.fromMatrix=function(t){if(!(t instanceof u))throw new TypeError("Expected DOMMatrix");return new u(t._values)},u.fromFloat32Array=function(t){if(!(t instanceof Float32Array))throw new TypeError("Expected Float32Array");return new u(t)},u.fromFloat64Array=function(t){if(!(t instanceof Float64Array))throw new TypeError("Expected Float64Array");return new u(t)},u.prototype[n.inspect.custom||"inspect"]=function(t,e){return t<0?"[DOMMatrix]":`DOMMatrix [\n    a: ${this.a}\n    b: ${this.b}\n    c: ${this.c}\n    d: ${this.d}\n    e: ${this.e}\n    f: ${this.f}\n    m11: ${this.m11}\n    m12: ${this.m12}\n    m13: ${this.m13}\n    m14: ${this.m14}\n    m21: ${this.m21}\n    m22: ${this.m22}\n    m23: ${this.m23}\n    m23: ${this.m23}\n    m31: ${this.m31}\n    m32: ${this.m32}\n    m33: ${this.m33}\n    m34: ${this.m34}\n    m41: ${this.m41}\n    m42: ${this.m42}\n    m43: ${this.m43}\n    m44: ${this.m44}\n    is2D: ${this.is2D}\n    isIdentity: ${this.isIdentity} ]`},u.prototype.toString=function(){return this.is2D?`matrix(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f})`:`matrix3d(${this._values.join(", ")})`},Object.defineProperties(u.prototype,{m11:{get:function(){return this._values[0]},set:function(t){return c(this,0,t)}},m12:{get:function(){return this._values[1]},set:function(t){return c(this,1,t)}},m13:{get:function(){return this._values[2]},set:function(t){return h(this,2,t)}},m14:{get:function(){return this._values[3]},set:function(t){return h(this,3,t)}},m21:{get:function(){return this._values[4]},set:function(t){return c(this,4,t)}},m22:{get:function(){return this._values[5]},set:function(t){return c(this,5,t)}},m23:{get:function(){return this._values[6]},set:function(t){return h(this,6,t)}},m24:{get:function(){return this._values[7]},set:function(t){return h(this,7,t)}},m31:{get:function(){return this._values[8]},set:function(t){return h(this,8,t)}},m32:{get:function(){return this._values[9]},set:function(t){return h(this,9,t)}},m33:{get:function(){return this._values[10]},set:function(t){return h(this,10,t)}},m34:{get:function(){return this._values[11]},set:function(t){return h(this,11,t)}},m41:{get:function(){return this._values[12]},set:function(t){return c(this,12,t)}},m42:{get:function(){return this._values[13]},set:function(t){return c(this,13,t)}},m43:{get:function(){return this._values[14]},set:function(t){return h(this,14,t)}},m44:{get:function(){return this._values[15]},set:function(t){return h(this,15,t)}},a:{get:function(){return this.m11},set:function(t){return this.m11=t}},b:{get:function(){return this.m12},set:function(t){return this.m12=t}},c:{get:function(){return this.m21},set:function(t){return this.m21=t}},d:{get:function(){return this.m22},set:function(t){return this.m22=t}},e:{get:function(){return this.m41},set:function(t){return this.m41=t}},f:{get:function(){return this.m42},set:function(t){return this.m42=t}},is2D:{get:function(){return this._is2D}},isIdentity:{get:function(){var t=this._values;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}}}),u.prototype.multiply=function(t){return f(this._values).multiplySelf(t)},u.prototype.multiplySelf=function(t){return this._values=l(t._values,this._values),t.is2D||(this._is2D=!1),this},u.prototype.preMultiplySelf=function(t){return this._values=l(this._values,t._values),t.is2D||(this._is2D=!1),this},u.prototype.translate=function(t,e,r){return f(this._values).translateSelf(t,e,r)},u.prototype.translateSelf=function(t,e,r){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof r&&(r=0),this._values=l([1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1],this._values),0!==r&&(this._is2D=!1),this},u.prototype.scale=function(t,e,r,n,i,o){return f(this._values).scaleSelf(t,e,r,n,i,o)},u.prototype.scale3d=function(t,e,r,n){return f(this._values).scale3dSelf(t,e,r,n)},u.prototype.scale3dSelf=function(t,e,r,n){return this.scaleSelf(t,t,t,e,r,n)},u.prototype.scaleSelf=function(t,e,r,n,i,o){return"number"!=typeof n&&(n=0),"number"!=typeof i&&(i=0),"number"!=typeof o&&(o=0),this.translateSelf(n,i,o),"number"!=typeof t&&(t=1),"number"!=typeof e&&(e=t),"number"!=typeof r&&(r=1),this._values=l([t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1],this._values),this.translateSelf(-n,-i,-o),1===r&&0===o||(this._is2D=!1),this},u.prototype.rotateFromVector=function(t,e){return f(this._values).rotateFromVectorSelf(t,e)},u.prototype.rotateFromVectorSelf=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var r=0===t&&0===e?0:Math.atan2(e,t)*o;return this.rotateSelf(r)},u.prototype.rotate=function(t,e,r){return f(this._values).rotateSelf(t,e,r)},u.prototype.rotateSelf=function(t,e,r){var n,i;return void 0===e&&void 0===r&&(r=t,t=e=0),"number"!=typeof e&&(e=0),"number"!=typeof r&&(r=0),0===t&&0===e||(this._is2D=!1),t*=s,e*=s,r*=s,n=Math.cos(r),i=Math.sin(r),this._values=l([n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1],this._values),n=Math.cos(e),i=Math.sin(e),this._values=l([n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1],this._values),n=Math.cos(t),i=Math.sin(t),this._values=l([1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1],this._values),this},u.prototype.rotateAxisAngle=function(t,e,r,n){return f(this._values).rotateAxisAngleSelf(t,e,r,n)},u.prototype.rotateAxisAngleSelf=function(t,e,r,n){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof r&&(r=0);var i=Math.sqrt(t*t+e*e+r*r);if(0===i)return this;1!==i&&(t/=i,e/=i,r/=i),n*=s;var o=Math.cos(n),a=Math.sin(n),u=1-o,c=u*t,h=u*e;return this._values=l([c*t+o,c*e+a*r,c*r-a*e,0,c*e-a*r,h*e+o,h*r+a*t,0,c*r+a*e,h*r-a*t,u*r*r+o,0,0,0,0,1],this._values),0===t&&0===e||(this._is2D=!1),this},u.prototype.skewX=function(t){return f(this._values).skewXSelf(t)},u.prototype.skewXSelf=function(t){if("number"!=typeof t)return this;var e=Math.tan(t*s);return this._values=l([1,0,0,0,e,1,0,0,0,0,1,0,0,0,0,1],this._values),this},u.prototype.skewY=function(t){return f(this._values).skewYSelf(t)},u.prototype.skewYSelf=function(t){if("number"!=typeof t)return this;var e=Math.tan(t*s);return this._values=l([1,e,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._values),this},u.prototype.flipX=function(){return f(l([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._values))},u.prototype.flipY=function(){return f(l([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],this._values))},u.prototype.inverse=function(){return f(this._values).invertSelf()},u.prototype.invertSelf=function(){throw new Error("Not implemented")},u.prototype.setMatrixValue=function(t){var e=new u(t);return this._values=e._values,this._is2D=e._is2D,this},u.prototype.transformPoint=function(t){var e=(t=new i(t)).x,r=t.y,n=t.z,o=t.w,s=this._values;return new i(s[0]*e+s[4]*r+s[8]*n+s[12]*o,s[1]*e+s[5]*r+s[9]*n+s[13]*o,s[2]*e+s[6]*r+s[10]*n+s[14]*o,s[3]*e+s[7]*r+s[11]*n+s[15]*o)},u.prototype.toFloat32Array=function(){return Float32Array.from(this._values)},u.prototype.toFloat64Array=function(){return this._values.slice(0)},t.exports={DOMMatrix:u,DOMPoint:i}},function(t,e,r){const n=r(12),i=r(15),o=r(5),s=r(6),a=r(27),u=r(1),c=r(28),h=r(7),f=r(8),l=r(9),p=r(3).DOMMatrix,d=r(3).DOMPoint;t.exports={Canvas:n,Context2d:o,CanvasRenderingContext2D:o,CanvasGradient:u.CanvasGradient,CanvasPattern:u.CanvasPattern,Image:i,ImageData:u.ImageData,PNGStream:h,PDFStream:f,JPEGStream:l,DOMMatrix:p,DOMPoint:d,registerFont:function(t,e){return n._registerFont(c.realpathSync(t),e)},parseFont:s,createCanvas:function(t,e,r){return new n(t,e,r)},createImageData:function(t,e,r){return new u.ImageData(t,e,r)},loadImage:function(t){return new Promise((e,r)=>{const n=new i;function o(){n.onload=null,n.onerror=null}n.onload=()=>{o(),e(n)},n.onerror=t=>{o(),r(t)},n.src=t})},backends:u.Backends,version:a.version,cairoVersion:u.cairoVersion,jpegVersion:u.jpegVersion,gifVersion:u.gifVersion?u.gifVersion.replace(/[^.\d]/g,""):void 0,freetypeVersion:u.freetypeVersion}},function(t,e,r){"use strict";
/*!
 * Canvas - Context2d
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const n=r(1),i=r(6),{DOMMatrix:o}=r(3);n.CanvasRenderingContext2dInit(o,i),t.exports=n.CanvasRenderingContext2d},function(t,e,r){"use strict";const n="'([^']+)'|\"([^\"]+)\"|[\\w\\s-]+",i=new RegExp("(bold|bolder|lighter|[1-9]00) +","i"),o=new RegExp("(italic|oblique) +","i"),s=new RegExp("(small-caps) +","i"),a=new RegExp("(ultra-condensed|extra-condensed|condensed|semi-condensed|semi-expanded|expanded|extra-expanded|ultra-expanded) +","i"),u=new RegExp("([\\d\\.]+)(px|pt|pc|in|cm|mm|%|em|ex|ch|rem|q) *((?:"+n+")( *, *(?:"+n+"))*)"),c={};t.exports=function(t){if(c[t])return c[t];const e=u.exec(t);if(!e)return;const r={weight:"normal",style:"normal",stretch:"normal",variant:"normal",size:parseFloat(e[1]),unit:e[2],family:e[3].replace(/["']/g,"").replace(/ *, */g,",")};let n,h,f,l,p=t.substring(0,e.index);switch((n=i.exec(p))&&(r.weight=n[1]),(h=o.exec(p))&&(r.style=h[1]),(f=s.exec(p))&&(r.variant=f[1]),(l=a.exec(p))&&(r.stretch=l[1]),r.unit){case"pt":r.size/=.75;break;case"pc":r.size*=16;break;case"in":r.size*=96;break;case"cm":r.size*=96/2.54;break;case"mm":r.size*=96/25.4;break;case"%":break;case"em":case"rem":r.size*=16/.75;break;case"q":r.size*=96/25.4/4}return c[t]=r}},function(t,e,r){"use strict";
/*!
 * Canvas - PNGStream
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */var n=r(2).Readable,i=r(0),o=t.exports=function t(e,r){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");if(n.call(this),r&&r.palette instanceof Uint8ClampedArray&&r.palette.length%4!=0)throw new Error("Palette length must be a multiple of 4.");this.canvas=e,this.options=r||{}};function s(){}i.inherits(o,n),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamPNGSync((function(e,r,n){e?t.emit("error",e):n?t.push(r):t.push(null)}),t.options)}},function(t,e,r){"use strict";
/*!
 * Canvas - PDFStream
 */var n=r(2).Readable,i=r(0),o=t.exports=function t(e,r){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");n.call(this),this.canvas=e,this.options=r};function s(){}i.inherits(o,n),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamPDFSync((function(e,r,n){e?t.emit("error",e):n?t.push(r):t.push(null)}),this.options)}},function(t,e,r){"use strict";
/*!
 * Canvas - JPEGStream
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */var n=r(2).Readable,i=r(0),o=t.exports=function t(e,r){if(!(this instanceof t))throw new TypeError("Class constructors cannot be invoked without 'new'");if(void 0===e.streamJPEGSync)throw new Error("node-canvas was built without JPEG support.");n.call(this),this.options=r,this.canvas=e};function s(){}i.inherits(o,n),o.prototype._read=function(){this._read=s;var t=this;t.canvas.streamJPEGSync(this.options,(function(e,r){e?t.emit("error",e):r?t.push(r):t.push(null)}))}},function(t,e,r){t.exports=r(29)},function(t,e,r){"use strict";r.r(e),r.d(e,"_Canvas",(function(){return i}));var n=r(4),i={name:"NodeCanvas",create:function(t,e){void 0===t&&(t=500),void 0===e&&(e=500);var r=Object(n.createCanvas)(t,e),i=r.getContext("2d");return[r,i]},loadImage:function(t){return Object(n.loadImage)(t)}}},function(t,e,r){"use strict";
/*!
 * Canvas
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const n=r(1),i=t.exports=n.Canvas,o=r(5),s=r(7),a=r(8),u=r(9),c=["image/png","image/jpeg"],h=r(0);i.prototype[h.inspect.custom||"inspect"]=function(){return`[Canvas ${this.width}x${this.height}]`},i.prototype.getContext=function(t,e){if("2d"==t){var r=this._context2d||(this._context2d=new o(this,e));return this.context=r,r.canvas=this,r}},i.prototype.pngStream=i.prototype.createPNGStream=function(t){return new s(this,t)},i.prototype.pdfStream=i.prototype.createPDFStream=function(t){return new a(this,t)},i.prototype.jpegStream=i.prototype.createJPEGStream=function(t){return new u(this,t)},i.prototype.toDataURL=function(t,e,r){var n,i="image/png",o={};if("function"==typeof t)n=t;else if("string"==typeof t&&c.includes(t.toLowerCase())&&(i=t.toLowerCase()),"function"==typeof e)n=e;else if("object"==typeof e?o=e:"number"==typeof e&&(o={quality:Math.max(0,Math.min(1,e))}),"function"==typeof r)n=r;else if(void 0!==r)throw new TypeError(typeof r+" is not a function");if(0===this.width||0===this.height){return n?void setTimeout(()=>n(null,"data:,")):"data:,"}if(!n)return`data:${i};base64,${this.toBuffer(i,o).toString("base64")}`;this.toBuffer((t,e)=>{if(t)return n(t);n(null,`data:${i};base64,${e.toString("base64")}`)},i,o)}},function(t,e,r){(function(t){try{global.process.dlopen(t,"/Users/guoxiaodong/Documents/App/@github/mcanvas/node_modules/canvas/build/Release/canvas.node")}catch(t){throw new Error("Cannot open /Users/guoxiaodong/Documents/App/@github/mcanvas/node_modules/canvas/build/Release/canvas.node: "+t)}}).call(this,r(14)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";
/*!
 * Canvas - Image
 * Copyright (c) 2010 LearnBoost <tj@learnboost.com>
 * MIT Licensed
 */const n=r(1),i=t.exports=n.Image,o=r(0);let s;const{GetSource:a,SetSource:u}=n;function c(t,e,r){u.call(t,e),t._originalSource=r}Object.defineProperty(i.prototype,"src",{set(t){if("string"==typeof t)if(/^\s*data:/.test(t)){const e=t.indexOf(","),r=-1!==t.lastIndexOf("base64",e),n=t.slice(e+1);c(this,Buffer.from(n,r?"base64":"utf8"),t)}else if(/^\s*https?:\/\//.test(t)){const e=t=>{if("function"!=typeof this.onerror)throw t;this.onerror(t)};s||(s=r(16)),s.concat(t,(t,r,n)=>t?e(t):r.statusCode<200||r.statusCode>=300?e(new Error("Server responded with "+r.statusCode)):void c(this,n))}else c(this,t);else Buffer.isBuffer(t)&&c(this,t)},get(){return(t=this)._originalSource||a.call(t);var t},configurable:!0}),i.prototype[o.inspect.custom||"inspect"]=function(){return"[Image"+(this.complete?":"+this.width+"x"+this.height:"")+(this.src?" "+this.src:"")+(this.complete?" complete":"")+"]"}},function(t,e,r){t.exports=f;const n=r(17),i=r(18),o=r(21),s=r(22),a=r(23),u=r(25),c=r(26),h=t=>null!==t&&"object"==typeof t&&"function"==typeof t.pipe;function f(t,e){if(t=Object.assign({maxRedirects:10},"string"==typeof t?{url:t}:t),e=a(e),t.url){const{hostname:e,port:r,protocol:n,auth:i,path:o}=c.parse(t.url);delete t.url,e||r||n||i?Object.assign(t,{hostname:e,port:r,protocol:n,auth:i,path:o}):t.path=o}const r={"accept-encoding":"gzip, deflate"};let n;t.headers&&Object.keys(t.headers).forEach(e=>r[e.toLowerCase()]=t.headers[e]),t.headers=r,t.body?n=t.json&&!h(t.body)?JSON.stringify(t.body):t.body:t.form&&(n="string"==typeof t.form?t.form:u.stringify(t.form),t.headers["content-type"]="application/x-www-form-urlencoded"),n&&(t.method||(t.method="POST"),h(n)||(t.headers["content-length"]=Buffer.byteLength(n)),t.json&&!t.form&&(t.headers["content-type"]="application/json")),delete t.body,delete t.form,t.json&&(t.headers.accept="application/json"),t.method&&(t.method=t.method.toUpperCase());const l=("https:"===t.protocol?s:o).request(t,r=>{if(!1!==t.followRedirects&&r.statusCode>=300&&r.statusCode<400&&r.headers.location)return t.url=r.headers.location,delete t.headers.host,r.resume(),"POST"===t.method&&[301,302].includes(r.statusCode)&&(t.method="GET",delete t.headers["content-length"],delete t.headers["content-type"]),0==t.maxRedirects--?e(new Error("too many redirects")):f(t,e);const n="function"==typeof i&&"HEAD"!==t.method;e(null,n?i(r):r)});return l.on("timeout",()=>{l.abort(),e(new Error("Request timed out"))}),l.on("error",e),h(n)?n.on("error",e).pipe(l):l.end(n),l}f.concat=(t,e)=>f(t,(r,i)=>{if(r)return e(r);n(i,(r,n)=>{if(r)return e(r);if(t.json)try{n=JSON.parse(n.toString())}catch(r){return e(r,i,n)}e(null,i,n)})}),["get","post","put","patch","head","delete"].forEach(t=>{f[t]=(e,r)=>("string"==typeof e&&(e={url:e}),f(Object.assign({method:t.toUpperCase()},e),r))})},function(t,e){t.exports=function(t,e){var r=[];t.on("data",(function(t){r.push(t)})),t.once("end",(function(){e&&e(null,Buffer.concat(r)),e=null})),t.once("error",(function(t){e&&e(t),e=null}))}},function(t,e,r){"use strict";const{PassThrough:n}=r(2),i=r(19),o=r(20),s=t=>{const e=(t.headers["content-encoding"]||"").toLowerCase();if(!["gzip","deflate","br"].includes(e))return t;const r="br"===e;if(r&&"function"!=typeof i.createBrotliDecompress)return t;const s=r?i.createBrotliDecompress():i.createUnzip(),a=new n;return o(t,a),s.on("error",t=>{"Z_BUF_ERROR"!==t.code?a.emit("error",t):a.end()}),t.pipe(s).pipe(a),a};t.exports=s,t.exports.default=s},function(t,e){t.exports=require("zlib")},function(t,e,r){"use strict";const n=["aborted","complete","destroy","headers","httpVersion","httpVersionMinor","httpVersionMajor","method","rawHeaders","rawTrailers","setTimeout","socket","statusCode","statusMessage","trailers","url"];t.exports=(t,e)=>{const r=new Set(Object.keys(t).concat(n));for(const n of r)n in e||(e[n]="function"==typeof t[n]?t[n].bind(t):t[n]);return e}},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e,r){var n=r(24);function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}t.exports=n(i),t.exports.strict=n(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},function(t,e){t.exports=function t(e,r){if(e&&r)return t(e)(r);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach((function(t){n[t]=e[t]})),n;function n(){for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];var n=e.apply(this,t),i=t[t.length-1];return"function"==typeof n&&n!==i&&Object.keys(i).forEach((function(t){n[t]=i[t]})),n}}},function(t,e){t.exports=require("querystring")},function(t,e){t.exports=require("url")},function(t){t.exports=JSON.parse('{"_from":"canvas","_id":"canvas@2.6.1","_inBundle":false,"_integrity":"sha512-S98rKsPcuhfTcYbtF53UIJhcbgIAK533d1kJKMwsMwAIFgfd58MOyxRud3kktlzWiEkFliaJtvyZCBtud/XVEA==","_location":"/canvas","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"canvas","name":"canvas","escapedName":"canvas","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/canvas/-/canvas-2.6.1.tgz","_shasum":"0d087dd4d60f5a5a9efa202757270abea8bef89e","_spec":"canvas","_where":"/Users/guoxiaodong/Documents/App/@github/mcanvas","author":{"name":"TJ Holowaychuk","email":"tj@learnboost.com"},"binary":{"module_name":"canvas","module_path":"build/Release","host":"https://github.com/node-gfx/node-canvas-prebuilt/releases/download/","remote_path":"v{version}","package_name":"{module_name}-v{version}-{node_abi}-{platform}-{libc}-{arch}.tar.gz"},"browser":"browser.js","bugs":{"url":"https://github.com/Automattic/node-canvas/issues"},"bundleDependencies":false,"contributors":[{"name":"Nathan Rajlich","email":"nathan@tootallnate.net"},{"name":"Rod Vagg","email":"r@va.gg"},{"name":"Juriy Zaytsev","email":"kangax@gmail.com"}],"dependencies":{"nan":"^2.14.0","node-pre-gyp":"^0.11.0","simple-get":"^3.0.3"},"deprecated":false,"description":"Canvas graphics API backed by Cairo","devDependencies":{"@types/node":"^10.12.18","assert-rejects":"^1.0.0","dtslint":"^0.5.3","express":"^4.16.3","mocha":"^5.2.0","pixelmatch":"^4.0.2","standard":"^12.0.1"},"engines":{"node":">=6"},"files":["binding.gyp","lib/","src/","util/","types/index.d.ts"],"homepage":"https://github.com/Automattic/node-canvas","keywords":["canvas","graphic","graphics","pixman","cairo","image","images","pdf"],"license":"MIT","main":"index.js","name":"canvas","repository":{"type":"git","url":"git://github.com/Automattic/node-canvas.git"},"scripts":{"benchmark":"node benchmarks/run.js","dtslint":"dtslint types","install":"node-pre-gyp install --fallback-to-build","prebenchmark":"node-gyp build","pretest":"standard examples/*.js test/server.js test/public/*.js benchmarks/run.js lib/context2d.js util/has_lib.js browser.js index.js && node-gyp build","pretest-server":"node-gyp build","test":"mocha test/*.test.js","test-server":"node test/server.js"},"types":"types/index.d.ts","version":"2.6.1"}')},function(t,e){t.exports=require("fs")},function(t,e,r){"use strict";r.r(e),r.d(e,"MCanvas",(function(){return y})),r.d(e,"MImage",(function(){return I}));var n={};function i(t){var e=n.toString.call(t);return null===t?t+"":Number.isNaN(t)?"NaN":"object"==typeof t||"function"==typeof t?n[e]||"object":typeof t}"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach((function(t){n["[object "+t+"]"]=t.toLowerCase()}));var o={primitive:function(t){return["string","number"].includes(i(t))},array:function(t){return"array"===i(t)},str:function(t){return"string"===i(t)},obj:function(t){return"object"===i(t)},arr:function(t){return"array"===i(t)},num:function(t){return"number"===i(t)},fn:function(t){return"function"===i(t)},undef:function(t){return"undefined"===i(t)},def:function(t){return!o.undef(t)},null:function(t){return"null"===i(t)},empty:function(t){switch(i(t)){case"object":return 0===Object.keys(t).length;case"array":return 0===t.length;case"string":return!t.trim();case"undefined":case"null":case"NaN":case"boolean":return!0;default:return!1}},Nil:function(t){return["null","undefined"].includes(i(t))},NaN:function(t){return"NaN"===i(t)},promise:function(t){return!!t&&(o.obj(t)||o.fn(t))&&o.fn(t.then)}};function s(t){var e={},r=e.toString,n=e.hasOwnProperty,i=n.toString,o=i.call(Object);if(!t||"[object Object]"!==r.call(t))return!1;var s=Object.getPrototypeOf(t);if(!s)return!0;var a=n.call(s,"constructor")&&s.constructor;return"function"==typeof a&&i.call(a)===o}function a(){for(var t,e,r,n,i,o,u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var h=arguments[0]||{},f=1,l=arguments.length,p=!1;for("boolean"==typeof h&&(p=h,h=arguments[f]||{},f++),"object"!=typeof h&&"function"!=typeof h&&(h={}),f===l&&(h=this,f--);f<l;f++)if(null!==(t=arguments[f]))for(e in t)if(t.hasOwnProperty(e)){if(i=h[e],h===(n=t[e]))continue;p&&n&&(s(n)||(o=Array.isArray(n)))?(o?(o=!1,r=i&&Array.isArray(i)?i:[]):r=i&&s(i)?i:{},h[e]=a(p,r,n)):void 0!==n&&(h[e]=n)}return h}function u(t,e){for(var r in t)t.hasOwnProperty(r)&&e(r,t[r])}function c(t){return"IMG"===t.tagName?{iw:t.naturalWidth,ih:t.naturalHeight}:{iw:t.width,ih:t.height}}function h(t,e){return t.indexOf&&-1!==t.indexOf(e)}function f(t,e,r,n){var i=r;if(o.str(r))if(h(r,":")&&"pos"===n){var s=r.split(":"),a=s[0],u=s[1];switch(a){case"left":case"top":i=+u.replace("px","");break;case"right":case"bottom":i=t-+u.replace("px","")-e}}else i=h(r,"px")?+r.replace("px",""):h(r,"%")?("crop"===n?e:t)*+r.replace("%","")/100:h(["top","left"],r)?0:h(["bottom","right"],r)?t-e:"center"===r?(t-e)/2:"origin"===r?e:+r;return Math.round(i)}function l(t,e){var r=e;return o.str(e)&&(r=h(e,"px")?+e.replace("px",""):h(e,"%")?t*+e.replace("%","")/100:"center"===e?t/2:+e),Math.round(r)}function p(t){throw new Error("[MCanvas ERROR]: "+t)}var d=r(11)._Canvas,v={getImage:function(t){return"string"==typeof t?g.loadImage(t):"object"==typeof t?Promise.resolve(t):Promise.reject("getImage error, src="+t)},drawRoundRectPath:function(t,e,r,n){t.beginPath(),t.arc(e-n,r-n,n,0,Math.PI/2),t.lineTo(n,r),t.arc(n,r-n,n,Math.PI/2,Math.PI),t.lineTo(0,n),t.arc(n,n,n,Math.PI,3*Math.PI/2),t.lineTo(e-n,0),t.arc(e-n,n,n,3*Math.PI/2,2*Math.PI),t.lineTo(e,r-n),t.closePath()},drawRoundRect:function(t,e,r,n,i,o,s,a,u){void 0===o&&(o=0),void 0===s&&(s="#fff"),void 0===a&&(a=0),void 0===u&&(u="#000");var c=Math.min(n,i);2*o>c&&(o=c/2),t.save(),t.translate(e,r),v.drawRoundRectPath(t,n,i,o),t.fillStyle=s,t.fill(),t.lineWidth=a,t.strokeStyle=u,t.stroke(),t.restore()}},g=a(!0,d,v);function m(t,e){var r=c(t),n=r.iw,i=r.ih,o=a(!0,{x:0,y:0,width:"100%",height:"100%",radius:0},e),s=o.width,u=o.height,h=o.x,p=o.y,d=o.radius;(s=l(n,s))>n&&(s=n),(u=l(i,u))>i&&(u=i),h=f(n,s,h,"pos"),p=f(i,u,p,"pos"),d=l(n,d);var v=g.create(s,u),m=v[0],y=v[1];return m.width=s,m.height=u,g.drawRoundRect(y,0,0,s,u,d),y.globalCompositeOperation="source-in",y.drawImage(t,-h,-p,n,i),{cvs:m,ctx:y}}var y=function(){function t(t){void 0===t&&(t={}),this.queue=[],this.fn={success:function(){},error:function(t){}},this.data={textId:0,text:{},bgConfig:null},this._defaultFontFamily="helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif",this.ops=a({width:500,height:500,backgroundColor:""},t),this._init()}return t.prototype._init=function(){var t,e=this.ops,r=e.width,n=e.height,i=e.backgroundColor;t=g.create(r,n),this.cvs=t[0],this.ctx=t[1],i&&this._setBgColor(i)},t.prototype.background=function(t,e){var r=this;return void 0===e&&(e={type:"origin"}),t||this.data.bgConfig?(t?(e.image=t,this.data.bgConfig=e):this.data.bgConfig&&(e=this.data.bgConfig),this.queue.push((function(){e.color&&r._setBgColor(e.color),g.getImage(e.image).then((function(t){return r._background(t,e)})).catch(r.fn.error)})),this):(p("the init background must has a image."),this)},t.prototype._setBgColor=function(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.cvs.width,this.cvs.height)},t.prototype._getBgAlign=function(t,e,r,n){var i;return o.str(t)?"50%"===t||"center"===t?i=Math.abs((e-r/n)/2):"100%"===t?i=Math.abs(e-r/n):"0%"===t&&(i=0):i=o.num(t)?t:0,i},t.prototype._background=function(t,e){var r,n,i,o,s,a,u,h,f,l=c(t),d=l.iw,v=l.ih,g=d/v,m=this.cvs.width/this.cvs.height;switch(e.type){case"crop":g>m?(i=v*m,o=v,f=this.cvs.height/v):(o=(i=d)/m,f=this.cvs.width/d),r=this._getBgAlign(e.left,d,this.cvs.width,f),n=this._getBgAlign(e.top,v,this.cvs.height,f),a=s=0,h=this.cvs.height,u=this.cvs.width;break;case"contain":n=r=0,i=d,o=v,g>m?(h=(u=this.cvs.width)/g,s=e.left||0,a=e.top||0===e.top?e.top:(this.cvs.height-h)/2):(u=(h=this.cvs.height)*g,a=e.top||0,s=e.left||0===e.left?e.left:(this.cvs.width-u)/2);break;case"origin":this.cvs.width=d,this.cvs.height=v,r=n=0,i=d,o=v,s=a=0,u=this.cvs.width,h=this.cvs.height;break;default:return void p("background type error!")}this.ctx.drawImage(t,r,n,i,o,s,a,u,h),this._next()},t.prototype.rect=function(t){var e=this;return void 0===t&&(t={}),this.queue.push((function(){var r=e.cvs,n=r.width,i=r.height,o=t.fillColor,s=void 0===o?"#fff":o,a=t.strokeColor,u=void 0===a?s:a,c=t.strokeWidth,l=void 0===c?0:c,p=t.radius,d=void 0===p?0:p,v=t.width,m=void 0===v?100:v,y=t.height,x=void 0===y?100:y,w=t.x,b=void 0===w?0:w,_=t.y,S=void 0===_?0:_;m=f(n,0,m,"pos")-2*l,x=f(i,0,x,"pos")-2*l,b=f(n,m,b,"pos")+(h(b,"right")?-l:l),S=f(i,x,S,"pos")+(h(S,"bottom")?-l:l),g.drawRoundRect(e.ctx,b,S,m,x,d,s,l,u),e._resetCtx()._next()})),this},t.prototype.circle=function(t){var e=this;return void 0===t&&(t={}),this.queue.push((function(){var r=t.fillColor,n=void 0===r?"#fff":r,i=t.strokeColor,o=void 0===i?n:i,s=t.strokeWidth,a=void 0===s?0:s,u=e.cvs,c=u.width,l=u.height,p=t.x,d=void 0===p?0:p,v=t.y,g=void 0===v?0:v,m=t.radius,y=f(c,0,void 0===m?100:m,"pos")-2*a;d=f(c,2*y,d,"pos")+y+(h(d,"right")?-a:a),g=f(l,2*y,g,"pos")+y+(h(g,"bottom")?-a:a),e.ctx.beginPath(),e.ctx.arc(d,g,y,0,2*Math.PI,!1),e.ctx.fillStyle=n,e.ctx.fill(),e.ctx.strokeStyle=o,e.ctx.lineWidth=a,e.ctx.stroke(),e.ctx.closePath(),e._resetCtx()._next()})),this},t.prototype._resetCtx=function(){return this.ctx.setTransform(1,0,0,1,0,0),this},t.prototype.watermark=function(t,e){if(void 0===e&&(e={}),!t)return p("there is not image of watermark."),this;var r=e.width,n=void 0===r?"40%":r,i=e.pos,o=void 0===i?"rightbottom":i,s=e.margin,a=void 0===s?20:s,u={x:0,y:0,scale:1,rotate:0};switch(o){case"leftTop":u.x="left:"+a,u.y="top:"+a;break;case"leftBottom":u.x="left:"+a,u.y="bottom:"+a;break;case"rightTop":u.x="right:"+a,u.y="top:"+a;break;case"rightBottom":u.x="right:"+a,u.y="bottom:"+a}return this.add(t,{width:n,pos:u}),this},t.prototype.add=function(t,e){var r=this,n={width:"100%",crop:{x:0,y:0,width:"100%",height:"100%",radius:0},pos:{x:0,y:0,scale:1,rotate:0}};return(o.arr(t)?t:[{image:t,options:e}]).map((function(t){var e=t.image,i=t.options;r.queue.push((function(){g.getImage(e).then((function(t){r._add(t,r._handleOps(t,a(!0,n,i)))})).catch(r.fn.error)}))})),this},t.prototype._add=function(t,e){var r,n=e.crop,i=e.pos,o=e.width;0===o&&function(t){throw new Error("[MCanvas WARN]: "+t)}("the width of mc-element is zero");var s,a,u,h,f=c(t),l=f.iw,p=f.ih,d=n.width,v=n.height,y=n.radius;(d!==l||v!==p||y>0)&&(t=m(t,n).cvs);var x,w,b,_,S,j,M=d/v,C=l>p?l/p:p/l,k=1.4*C>5?5:1.4*C,I=g.create(Math.round(d*k),Math.round(v*k)),P=I[0],D=I[1],O=M>1?4096/P.width:4096/P.height;x=-Math.round(d/2),w=-Math.round(v/2),b=d,_=Math.round(d/M),(P.width>4096||P.height>4096)&&O&&(r=[P.width,P.height,x,w,b,_].map((function(t){return Math.round(t*O)})),P.width=r[0],P.height=r[1],x=r[2],w=r[3],b=r[4],_=r[5]),D.translate(P.width/2,P.height/2),D.rotate(i.rotate),D.drawImage(t,x,w,b,_),u=Math.round(o*k),h=Math.round(u/M),j=(S=(k-1)*o/2)/M,s=Math.round(i.x+u*(1-i.scale)/2-S),a=Math.round(i.y+h*(1-i.scale)/2-j),u*=i.scale,h*=i.scale,this.ctx.drawImage(P,s,a,u,h),this._next()},t.prototype._getRotate=function(t){return o.str(t)?parseFloat(t)*Math.PI/180:o.num(t)?t*Math.PI/180:0},t.prototype._handleOps=function(t,e){var r,n,i=this.cvs,o=i.width,s=i.height,a=c(t),u=a.iw,h=a.ih,p=u/h,d=f(o,u,e.width,"pos"),v=f(o,u,e.crop.width,"crop"),g=f(s,h,e.crop.height,"crop"),m={width:v,height:g,x:f(u,v,e.crop.x,"crop"),y:f(h,g,e.crop.y,"crop"),radius:l(v,e.crop.radius)};m.x>u&&(m.x=u),m.y>h&&(m.y=h),r=u-m.x,n=h-m.y,m.width>r&&(m.width=r),m.height>n&&(m.height=n);var y=e.pos,x=y.x,w=y.y,b=y.rotate,_=y.scale,S=void 0===_?1:_;return{width:d,crop:m,pos:{x:f(o,d,x,"pos"),y:f(s,d/p,w,"pos"),scale:S,rotate:this._getRotate(b)}}},t.prototype._createStyle=function(t,e){return{font:t+"px "+this._defaultFontFamily,lineHeight:e,color:"#000",type:"fill",lineWidth:1,shadow:{color:null,blur:0,offsetX:0,offsetY:0}}},t.prototype.text=function(t,e){var r=this;void 0===e&&(e={});var n=this.cvs.width/20;return this.queue.push((function(){var i,o=a(!0,{width:300,align:"left",smallStyle:r._createStyle(.8*n,.9*n),normalStyle:r._createStyle(n,1.1*n),largeStyle:r._createStyle(1.3*n,1.4*n),pos:{x:0,y:0,rotate:0}},e),s=r._parse(String(t)),u=0;s.map((function(t){t.size>u&&(u=t.size,i=t.type)}));var c=parseInt(o[i+"Style"].font);c&&o.width<c&&(o.width=c),r._text(s,o),r._resetCtx()._next()})),this},t.prototype._parse=function(t){for(var e=t.split(/<s>|<b>/),r=[],n=0;n<e.length;n++){var i=e[n];if(/<\/s>|<\/b>/.test(i)){var o=/<\/s>/.test(i)?"</s>":"</b>",s=/<\/s>/.test(i)?"small":"large",a=e[n].split(o);r.push({type:s,text:a[0],size:"small"===s?0:2}),a[1]&&r.push({type:"normal",text:a[1],size:1})}else e[n]&&r.push({text:e[n],type:"normal",size:1})}return r},t.prototype._text=function(t,e){var r=this;this.data.textId++,this.data.text[this.data.textId]={};var n,i=e.width=f(this.cvs.width,0,e.width,"pos"),o=1,s=0,a=this._getLineHeight(t,e),c=f(this.cvs.width,i,0,"pos"),l=f(this.cvs.height,0,0,"pos")+a;this.data.text[this.data.textId][o]={data:[],lineWidth:0},t.map((function(t){n=e[t.type+"Style"],r.ctx.font=n.font;var u=r.ctx.measureText(t.text).width,f=t.text.replace(/<br>/g,"|");if(s+u>i||h(f,"|"))for(var p=0,d=f.length;p<d;p++){var v,g=f[p];if(u=r.ctx.measureText(g).width,!(s+u>i||"|"===g)||(c=s=0,l+=a,o+=1,r.data.text[r.data.textId][o]={data:[],lineWidth:0},"|"!==g))(v=r.data.text[r.data.textId][o]).data.push({context:g,x:c,y:l,style:n,width:u}),c+=u,v.lineWidth=s+=u}else(v=r.data.text[r.data.textId][o]).data.push({context:f,x:c,y:l,style:n,width:u}),c+=u,v.lineWidth=s+=u}));var p=g.create(i,this._getTextRectHeight(o)),d=p[0],v=p[1],m=d.height,y=d.width,x=f(this.cvs.width,y,e.pos.x,"pos"),w=f(this.cvs.height,m,e.pos.y,"pos");u(this.data.text[this.data.textId],(function(t,n){var o=0;n.lineWidth<i&&("center"===e.align?o=(i-n.lineWidth)/2:"right"===e.align&&(o=i-n.lineWidth)),n.data.map((function(t){t.x+=o,r._fillText(v,t)}))})),this.ctx.translate(x+y/2,w+m/2),this.ctx.rotate(this._getRotate(e.pos.rotate)),this.ctx.drawImage(d,-y/2,-m/2,y,m)},t.prototype._getLineHeight=function(t,e){var r,n=0;return t.map((function(t){(r=e[t.type+"Style"].lineHeight)>n&&(n=r)})),n},t.prototype._fillText=function(t,e){var r=e.context,n=e.x,i=e.y,o=e.style,s=o.align,a=o.lineWidth,c=o.shadow,h=o.font,f=o.gradient,l=o.lineHeight,p=c.color,d=c.blur,v=c.offsetX,g=c.offsetY;if(t.font=h,t.textAlign=s,t.textBaseline="alphabetic",t.lineWidth=a,t.shadowColor=p,t.shadowBlur=d,t.shadowOffsetX=v,t.shadowOffsetY=g,f){var m=f.type,y=f.colorStop,x=void 0,w=void 0,b=void 0,_=void 0;1===m?(x=n,w=i,b=n+e.width,_=i):(x=n,w=i-l,b=n,_=i);var S=t.createLinearGradient(x,w,b,_),j=y.length||0;u(y,(function(t,e){S.addColorStop(1/j*(+t+1),e)})),t[o.type+"Style"]=S}else t[o.type+"Style"]=o.color;t[o.type+"Text"](r,n,i),this._resetCtx()},t.prototype._getTextRectHeight=function(t){var e=this.data.text[this.data.textId][t].data[0];return e.y+e.style.lineHeight},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(r,n){var i={type:"jpeg",quality:.9,exportType:"base64",success:function(t){},error:function(t){}};o.fn(t)?i.success=t:"jpg"===(i=a(!0,i,t)).type&&(i.type="jpeg"),e.fn.error=function(t){i.error(t),n(t)},e.fn.success=function(){"canvas"===i.exportType?(i.success(e.cvs),r(e.cvs)):setTimeout((function(){var t=e.cvs.toDataURL("image/"+i.type,i.quality);i.success(t),r(t)}),0)},e._next()}))},t.prototype._next=function(){if(this.queue.length>0){this.ctx.save();var t=this.queue.shift();t&&t(),this.ctx.restore()}else this.fn.success()},t.prototype.clear=function(){return this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function x(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))}function w(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function b(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}Object.create;var _=function(){function t(t){var e=this;this.isFirst=!0,this.queue=[],this._next=function(t){if(e.isFirst||(t=e.after(t)),e.queue.length>0){var r=e.queue.shift();r&&(t=e.before(t),r(e._next,t),e.isFirst=!1)}else e.end(t),e.queue=[]};var r=t||{},n=r.before,i=void 0===n?function(t){return t}:n,o=r.after,s=void 0===o?function(t){return t}:o;this.before=i,this.after=s}return t.prototype.push=function(t){o.fn(t)&&this.queue.push(t)},t.prototype.perform=function(t,e){this.end=t,this._next(e)},t}();!function(){function t(){this._queue=new _}t.prototype.line=function(t){var e=this;return this._queue.push((function(r,n){setTimeout((function(){return x(e,void 0,void 0,(function(){var e;return w(this,(function(i){return e=t(n),o.promise(e)?e.then(r):r(e),[2]}))}))}),0)})),this},t.prototype.start=function(t,e){this._queue.perform(t,e)}}();function S(t,e){void 0===e&&(e=6);var r=t.getContext("2d");r.globalAlpha=1/(2*+e);for(var n=-e;n<=e;n+=2)for(var i=-e;i<=e;i+=2)r.drawImage(t,i,n),i>=0&&n>=0&&r.drawImage(t,-(i-1),-(n-1));return r.globalAlpha=1,[t,r]}function j(t,e){void 0===e&&(e="hor");var r,n,i,o,s=t.width,a=t.height,u=t.getContext("2d"),c=u.getImageData(0,0,s,a).data,h=u.createImageData(s,a),f=h.data;for(r=0;r<a;r++)for(n=0;n<s;n++)i=4*(r*s+n),f[o="hor"===e?4*(r*s+(s-n-1)):4*((a-r-1)*s+n)]=c[i],f[o+1]=c[i+1],f[o+2]=c[i+2],f[o+3]=c[i+3];return u.putImageData(h,0,0),[t,u]}function M(t){var e,r,n=t.width,i=t.height,o=t.getContext("2d"),s=o.getImageData(0,0,n,i).data,a=o.createImageData(n,i),u=a.data;for(e=0;e<s.length;e+=4)r=.3*s[e]+.59*s[e+1]+.11*s[e+2],u[e]=u[e+1]=u[e+2]=r,u[e+3]=s[e+3];return o.putImageData(a,0,0),[t,o]}function C(t,e){void 0===e&&(e=10);var r,n,i,o,s,a,u,c,h,f,l,p,d,v,g,m=t.width,y=t.height,x=t.getContext("2d"),w=x.getImageData(0,0,m,y).data,b=x.createImageData(m,y),_=b.data,S=Math.ceil(m/e),j=Math.ceil(y/e);for(r=0;r<j;r++)for((a=(s=r*e)+e)>y&&(a=y),n=0;n<S;n++){for((o=(i=n*e)+e)>m&&(o=m),p=d=v=g=0,l=(o-i)*(a-s),c=s;c<a;c+=1)for(h=c*m,u=i;u<o;u+=1)p+=w[f=h+u<<2],d+=w[f+1],v+=w[f+2],g+=w[f+3];for(p=p/l+.5|0,d=d/l+.5|0,v=v/l+.5|0,g=g/l+.5|0,c=s;c<a;c++)for(h=c*m,u=i;u<o;u++)_[f=h+u<<2]=p,_[f+1]=d,_[f+2]=v,_[f+3]=g}return x.putImageData(b,0,0),[t,x]}function k(t,e,r){void 0===e&&(e=2),void 0===r&&(r=32);var n,i,o,s,a,u,c,h,f,l,p,d,v,g,m,y,x,w,b=t.width,_=t.height,S=t.getContext("2d"),j=S.getImageData(0,0,b,_).data,M=S.createImageData(b,_),C=M.data,k=[],I=[],P=[],D=[],O=[],E=[],R=0;for(u=0;u<_;u++)for(a=0;a<b;a++){for(c=0;c<r;c++)k[c]=I[c]=P[c]=D[c]=O[c]=E[c]=0;for(h=-e;h<=e;h++)if(!((n=u+h)<0||n>=_))for(o=n*b,f=-e;f<=e;f++)(i=a+f)<0||i>=b||(l=j[s=o+i<<2],g=(p=j[s+1])*r>>8,m=(d=j[s+2])*r>>8,D[v=l*r>>8]+=l,O[g]+=p,E[m]+=d,k[v]+=1,I[g]+=1,P[m]+=1);for(y=x=w=0,c=1;c<r;c++)k[c]>k[y]&&(y=c),I[c]>I[x]&&(x=c),P[c]>P[w]&&(w=c);C[R]=D[y]/k[y]|0,C[R+1]=O[x]/I[x]|0,C[R+2]=E[w]/P[w]|0,C[R+3]=j[R+3],R+=4}return S.putImageData(M,0,0),[t,S]}var I=function(){function t(t){this._image=t,this._queue=new _,this.clear()}return t.prototype.clear=function(){return this._getImage()._drawCanvas(),this},t.prototype._drawCanvas=function(){return this._run((function(t){var e=c(t),r=e.iw,n=e.ih,i=g.create(r,n),o=i[0],s=i[1];return s.drawImage(t,0,0,r,n),{cvs:o,ctx:s}}))},t.prototype._getImage=function(){var t=this;return this._run((function(){return new Promise((function(e){return x(t,void 0,void 0,(function(){var t=this;return w(this,(function(r){return o.str(this._image)?g.getImage(this._image).then((function(r){return e(t._image=r)})).catch(this._error):e(this._image),[2]}))}))}))}))},t.prototype._run=function(t){var e=this;return this._queue.push((function(r,n){setTimeout((function(){return x(e,void 0,void 0,(function(){var e;return w(this,(function(i){return e=t(n),o.promise(e)?e.then(r):r(e),[2]}))}))}),0)})),this},t.prototype.draw=function(t){var e=this;return void 0===t&&(t={}),new Promise((function(r,n){var i={type:"jpeg",quality:1,exportType:"base64",success:function(t){},error:function(t){}};o.fn(t)?i.success=t:"jpg"===(i=a(!0,i,t)).type&&(i.type="jpeg");var s=i.exportType,u=i.type,c=i.quality,h=i.success,f=i.error,l=function(t){h(t),r(t),e.clear()};e._error=function(t){f(t),n(t)},e._queue.perform((function(t){var e=t.cvs,r=t.quality;"canvas"===s?l(e):setTimeout((function(){var t=e.toDataURL("image/"+u,r||c);l(t)}),0)}))}))},t.prototype.crop=function(t){return void 0===t&&(t={}),this._run((function(e){return m(e.cvs,t)}))},t.prototype.compress=function(t){return void 0===t&&(t={}),this._run((function(e){var r=e.cvs,n=e.ctx,i=t.quality,s=t.width,a=t.height,u=r.width/r.height;if(!o.num(s)&&!o.num(a))return{cvs:r,ctx:n,quality:i};o.num(s)||(s=a*u),o.num(a)||(a=s/u);var c=g.create(s,a),h=c[0],f=c[1];return f.drawImage(r,0,0,s,a),{cvs:h,ctx:f,quality:i}}))},t.prototype.filter=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this._run((function(r){var n,i,o,s,a,u=r.cvs,c=u,h=r.ctx;switch(t){case"blur":c=(n=S.apply(void 0,b([u],e)))[0],h=n[1];break;case"flip":c=(i=j.apply(void 0,b([u],e)))[0],h=i[1];break;case"gray":c=(o=M(u))[0],h=o[1];break;case"mosaic":c=(s=C.apply(void 0,b([u],e)))[0],h=s[1];break;case"oil":c=(a=k.apply(void 0,b([u],e)))[0],h=a[1]}return{cvs:c,ctx:h}}))},t}();e.default=y}])}));